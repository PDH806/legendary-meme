<!DOCTYPE html>
<html>

<head>

<style>
table, td {border-collapse: collapse;}
td {padding: 10px;}
</style>


<?
	$category 		= $_GET["category"];
	$Player_search 	= $_POST["Player"];
	$Year_search 	= $_POST["Year"];
	$Gender_search 	= $_POST["GENDER"];
	
	if($Gender_search == 'W'){$cheched_W = 'checked';}
	if($Gender_search == 'M'){$cheched_M = 'checked';}


	$page = ($_GET['page'])?$_GET['page']:1;
	$list = 100; // 페이자당 목록수
	$show = 10; // 하단 페이지네이션 갯수

    $db_start = ($page - 1) * $list;
	$db_end = $db_start + $list;
	
	$main_title = '한국 스키장 경영협회';
	$link 	= 	mysqli_connect("dbserver","skiresort","ll170505","skiresort");
	
	include 'db_config.html';
	
	$connect=mysql_connect("dbserver","skiresort","ll170505");
	mysql_select_db( "skiresort",$connect);

?>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<link rel="shortcut icon" href="Myicon.png" type="image/x-icon">
    
    <title>
    	<? echo "$main_title / $page"; ?>    
    </title>
    
		<!-- Custom styles for AUGMENT-SKI -->
			<? include 'link-files.html'; ?>
		<!-- end of Link -->
		
</head>



<body>

		<!-- Navigation for AUGMENT-SKI -->
			<? include 'main_nav2.html'; ?>
		<!-- end of Navigation -->

<br><br><br><br>

<?

	if ($rank <> 9){echo " <script language='javascript'>top.document.location.href = 'member_login.html?MEMBER_ID=$User_ID_Search&Case=9'</script>";}
					
	if (!$category)

		{
			if($Player_search){$search1 = " a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.LICENSE_YEAR = '$Year_search'";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search1 or $search2 or $search3){$search = 'where'.$search1.$search2.$search3;}
			
 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC" ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end" ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
 		}
 
  if ($category == '3')
		{
			
 			$query= "select * from 7G_Skiresort_Member where (T1_LICENSE = '0' or T1_LICENSE = '') and (T2_LICENSE = '0' or T2_LICENSE = '') and T3_LICENSE = '0' and SBT1_LICENSE = '0' and SBT2_LICENSE = '0' and SBT3_LICENSE = '0'order by MEMBER_NAME ASC " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result);

 		}

 if ($category == '4')
		{
			$search0 = " a.T1_LICENSE = 1";
			if($Player_search){$search1 = " and a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.T1_YEAR = $Year_search";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search0 or $search1 or $search2 or $search3){$search = 'where'.$search0.$search1.$search2.$search3;}

 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
		}

 if ($category == '5')
		{
			$search0 = " a.T2_LICENSE = 1";
			if($Player_search){$search1 = " and a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.T2_YEAR = '$Year_search'";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search0 or $search1 or $search2 or $search3){$search = 'where'.$search0.$search1.$search2.$search3;}

 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
 		}

 if ($category == '6')
		{
			$search0 = " a.T3_LICENSE = 1";
			if($Player_search){$search1 = " and a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.T3_YEAR = '$Year_search'";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search0 or $search1 or $search2 or $search3){$search = 'where'.$search0.$search1.$search2.$search3;}

 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
 		}

 
  if ($category == '7')
		{
			$search0 = " a.SBT1_LICENSE = 1";
			if($Player_search){$search1 = " a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.LICENSE_YEAR = '$Year_search'";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search0 or $search1 or $search2 or $search3){$search = 'where'.$search0.$search1.$search2.$search3;}

 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
 		}

 if ($category == '8')
		{
			$search0 = " a.SBT2_LICENSE = 1";
			if($Player_search){$search1 = " a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.LICENSE_YEAR = '$Year_search'";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search0 or $search1 or $search2 or $search3){$search = 'where'.$search0.$search1.$search2.$search3;}

 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);

 		}

 if ($category == '9')
		{
			$search0 = " a.PATROL_LICENSE = 1";
			if($Player_search){$search1 = " and a.MEMBER_NAME like '%$Player_search%'";}
			if($Year_search){$search2 = " and a.LICENSE_YEAR = '$Year_search'";}
			if($Gender_search){$search3 = " and b.ADD_SEX = '$Gender_search'";}
		 	if($search0 or $search1 or $search2 or $search3){$search = 'where'.$search0.$search1.$search2.$search3;}

 			$query1= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
 		}

 if ($category == '10')
		{
 			$query1= "select * from 7G_T_Reserve_New a left join 7G_T_Reserve_Info b on a.rs_seq=b.rs_seq and a.idkey=b.idkey and a.gd_seq=b.gd_seq where a.MEMBER_TYPE = 'skit3_referee' $Player_search_sql $License_year_sql $Gender_sql order by a.RS_BUYER_NAME ASC " ;
 			$result1=mysql_query($query1,$connect );

 			$query= "select * from 7G_T_Reserve_New a left join 7G_T_Reserve_Info b on a.rs_seq=b.rs_seq and a.idkey=b.idkey and a.gd_seq=b.gd_seq where a.MEMBER_TYPE = 'skit3_referee' $Player_search_sql $License_year_sql $Gender_sql order by a.RS_BUYER_NAME ASC limit $db_start, $db_end " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result1);
 		}

 
 if ($category == '21')
		{
 			$query= "select * from 7G_Skiresort_Member where rank = '8' or rank = '9' order by AGREEMENT_DATE DESC " ;
 			$result=mysql_query($query,$connect );
 			$row=mysql_fetch_array($result);
			$total_record = mysql_num_rows($result);

 		}


	$max_page1 = floor($total_record / $list);
	$max_page2 = $total_record / $list;
	if ($max_page2 > $max_page1){$max_page = $max_page1 + 1;}else{$max_page = $max_page1;}
	if ($page>$max_page){$page = $max_page;}
	$previous = $page - 1;
	$next = $page + 1;
	if ($next>$max_page){$next = $max_page;}
	if ($previous<1){$previous = 1;}
	$page_start = (($page - 1) * $list );
	if ($page_start <= 0){$page_start = 0;}
	$page_end = $page_start + $list;



 
 	echo "
    <br><br>
	<div class='container-fluid'>
		<div class='container text-center' style = 'padding:0px;'>
          		<p style = 'font-size:35px;font-weight:600;'>온라인 회원 리스트</p>
          		<p style = 'font-size:18px;font-weight:600;'>(총 $total_record 명)</p><br><br><br>
		</div>
		
		<div class='container text-left' style = 'padding:0px;'>

			<form method='post' action='admin_member.html?category=$category'>

		<table><tr>
		
				<td><input type='text' class='form-control' value = '$Player_search' name='Player' placeholder='검색하실 성명' width = 100% style = 'padding:5px;'></td>
				<td><input class='form-control' type='text' value = '$Year_search' name='Year' placeholder='검색하실 자격취득 연도' width = 100% ></td>
				</tr></table>
				&nbsp;&nbsp;<input type='checkbox' name='GENDER' value='M' $cheched_M>남자
				&nbsp;&nbsp;<input type='checkbox' name='GENDER' value='W' $cheched_W>여자
				&nbsp;&nbsp;<input type='Submit' value='검색' >
			</form>
			<br>
			<br>
			<br><br>
		</div>
	</div>";
	


 // 특정한 검색조건에서만 수행하는 조건절
 if (!$category or $category == '1' or $category == '2' or $category == '3' or $category == '4' or $category == '5' or $category == '6' or $category == '7' or $category == '8' or $category == '9' or $category == '21')
 {
 
 	if ($page_end > $total_record) {$page_end = $total_record;}

	$List_No = $page_start + 1;

	for($i=$page_start; $i<$page_end; $i++){
 	
 		if ($row[BIRTH] == '0000-00-00'){$row[BIRTH] = $row[ADD_BIRTH];}
 		if (substr($row[MEMBER_ID],0,3) == 'NO_'){$row[MEMBER_ID] = "미등록"; $text_color = 'color:#ff9500;';}
		// 짝수칸에 배경색 지정	
 	
 	
 		if ($MEMBER_CHECK != $row[PHONE]){

											echo "<div class='card col-2-lg col-12-xs' style='height:600px;'>";
													
															if($row[image]){$img = "<img class='card-img-top' src = '../view3.html?id=$row[MEMBER_ID]' width = 300px><br>";}
															
															else
															{
															
															if(!$row[EXT] and !$row[PHOTO3]){$img = "<img class='card-img-top' src = '../data/no_image.jpg' width = 300px><br>";}
														
															if($row[EXT] and !$row[PHOTO3]){
															if(!$category or $category == '1' or $category == '2' or $category == '3'){$image_file = $row[PHOTO3];}
															if($category == '4'){$image_file = "$row[NO_T1].$row[EXT]";}
															if($category == '5'){$image_file = "$row[NO_T2].$row[EXT]";}
															if($category == '6'){$image_file = "$row[NO_T3].$row[EXT]";}

															if($category == '7'){$image_file = "$row[NO_SBT1].$row[EXT]";}
															if($category == '8'){$image_file = "$row[NO_SBT2].$row[EXT]";}
															if($category == '9'){$image_file = "$row[NO_P].$row[EXT]";}

															if($row[PHOTO3] == '' and ($category > 3 and $category))
															{
																echo "NO<br>";
																$update_photo = "update 7G_Skiresort_Member set PHOTO3 = '$image_file' where NO = $row[NO]"; 
																$update_result = mysql_query($update_photo,$connect);	 				  
															}  				  
															
																$img = "<img class='card-img-top' src = '../data/$image_file' width = 300px><br><br>";
															}
															
															if($row[PHOTO3]){$image_file = "$row[PHOTO3]"; $img = "<img class='card-img-top' src = '../data/$image_file' width = 300px><br>";}
															
															} 
													
													
														echo "
														<a href=admin_member_edit.html?No=$row[NO]>$img</a>
														<p class = 'card-text font24' style = 'padding-left:10px;'>
														$List_No $row[MEMBER_NAME] ($row[MEMBER_ID]) $GENDER 
														<a class='badge badge-primary' href=admin_member_edit.html?No=$row[NO]>관리</a></p></a>";
																											
														if ($row[BIRTH]){echo "･ 생년월일 : $row[BIRTH]<br>";}

														if ($row[T1_LICENSE_No]){echo "･ 스키티칭1 : $row[T1_LICENSE_No]<br>";}
														if ($row[T2_LICENSE_No]){echo "･ 스키티칭2 : $row[T2_LICENSE_No]<br>";}
														if ($row[T3_LICENSE_No]){echo "･ 스키티칭3 : $row[T3_LICENSE_No]<br>";}

			
														if ($row[SBT1_LICENSE_No]){echo "･ 보드티칭1 : $row[SBT1_LICENSE_No]<br>";}
														if ($row[SBT2_LICENSE_No]){echo "･ 보드티칭2 : $row[SBT2_LICENSE_No]<br>";}
														if ($row[SBT3_LICENSE_No]){echo "･ 보드티칭3 : $row[SBT3_LICENSE_No]<br>";}
														if ($row[PATROL_LICENSE_No]){echo "･ 구조요원3 : $row[PATROL_LICENSE_No]<br>";}															
															
															
															
															if (!$row[GENDER] or $row[GENDER] == 0){
															echo "<div class='card-body'>";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=1&SNo=$i' class='btn btn-rounded btn-info' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>남자</a>&nbsp";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=2&SNo=$i' class='btn btn-rounded btn-danger' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>여자</a>&nbsp;";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=3&SNo=$i' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>관리자</a>&nbsp;";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=0&SNo=$i&s_photo=8' class='btn btn-rounded btn-dribbble' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>사진편집</a>&nbsp;";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=0&SNo=$i&s_photo=9' class='btn btn-rounded btn-secondary' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>사진교체</a><br><br>";

															}
															
															
															
															
																												
																
												echo "</div></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";

														}
												

											$List_No = $List_No + 1;
									}
									}
									}
									}
											$MEMBER_CHECK = $row[PHONE];
											$row=mysql_fetch_array($result);
											$i = $i + 1;		
									}
									
									echo "</div><br><br><br>";
 

 if ($category == '10')
 {
 
 echo "  
 
		<!-- Tap Menu -->
				<table class = 'table table-striped' width = 100% >
  					<thead class='thead-dark'>

						<td align = center><b>번호</b></td>
						<td></td>
   						<td align = center><b>성명(영문)</b></td>
   						<td align = center><b>전화번호</b></td>
   						<td align = center><b>생년월일</b></td>
   						<td align = center><b>주소</b></td>
   						<td align = center><b>관리</b></td>

					</th>
";
 
 
 
if ($page_end > $total_record) {$page_end = $total_record;}

for($i=$page_start; $i<$page_end; $i++)
  	{

 	if ($row[ADD_NAME_KOR] == ''){$row[ADD_NAME_KOR] = $row[RS_BUYER_NAME];}
	if ($row[ADD_TEL] == ''){$row[ADD_TEL] = $row[RS_BUYER_TEL];}
    $j = $i + 1;
 	
     echo "

    	 <tr>
			<td align = center>
              $j
			</td>
			
			<td>";			
			$photo_url = substr($row[RS_BUYER_PHOTO],0,5);
			
			if($photo_url == "/data")
				{$photo_url2 = '/skiresort';	
					echo "<img src = $photo_url2"."$row[RS_BUYER_PHOTO] width = 100>";
				} 
			elseif($photo_url == "http:")
				{
					echo "<img src = $row[RS_BUYER_PHOTO] width = 100>";
				}


                if($row[RS_BUYERS_NAME_ENG]) {$row[ADD_NAME_ENG] = $row[RS_BUYERS_NAME_ENG];}
                if($row[RS_BUYERS_TEL]) 	{$row[ADD_TEL] = $row[RS_BUYERS_NAME_ENG];}
                if($row[ZIP_CODE]) 			{$row[ADD_ZIPCODE] = $row[ZIP_CODE];}
                if($row[ADDR1]) 			{$row[ADD_ADDR1] = $row[ADDR1];}
                if($row[ADDR2]) 			{$row[ADD_ADDR2] = $row[ADDR2];}


			echo "
			</td>

			<td align = left>
               $row[ADD_NAME_KOR]&nbsp;($row[ADD_NAME_ENG])<br>
				$row[LICENSE_NUM] 
			</td>

			<td align = left>
               $row[ADD_TEL]     
			</td>

			<td align = center>
               $row[ADD_BIRTH]
			</td>
			
			<td align = left>
               $row[ADD_ZIPCODE]<br>
               $row[ADD_ADDR1] $row[ADD_ADDR2]<br>
            </td>
            <td>
				<a class='badge badge-primary' href=admin_member_edit_01.html?No=$row[NO]><font color = white>정보확인</font></a>&nbsp;
 			</td>

		<tr> ";	

 		  $row=mysql_fetch_array($result);
   }
 
   echo( "</table>");
   
}
  
 ?>
 
 <br>

<?

echo "

<nav aria-label='...'>

	<ul class='pagination justify-content-center'>
  
		<li class='page-item'>
			<a class='page-link' href='admin_member.html?category=$category&page=$previous'>Previous</a>
    	</li>";
    	
    	
$show_end_page = $page+$show;
$show_start_page = $page;

if ($show_end_page > $max_page){$show_end_page = $max_page + 1;}
if ($max_page <= $show){$show_start_page = 1;}
    	
for($i=$show_start_page; $i<$show_end_page; $i++)
	{
    	if($page == $i)
    		{
    			echo "
    			<li class='page-item active' aria-current='page'>
      				<a class='page-link' href='admin_member.html?category=$category&page=$i'>$i<span class='sr-only'>(current)</span><a>
    			</li>";
   			}
    
    	else
    	
    		{
    			echo "
    		   	<li class='page-item'>
    				<a class='page-link' href='admin_member.html?category=$category&page=$i'>$i</a>
    			</li>";
    		}


	}    
    echo "
    	<li class='page-item'>
      		<a class='page-link' href='admin_member.html?category=$category&page=$next'>Next</a>
    	</li>
    
  </ul>
  
</nav>
<br><br><br>";
?>
 
 
 
 
       </div>
  </div>
</div>
 
     <!-- footer for AUGMENT-SKI -->
	<? include 'footer.html'; ?>
	<!-- end of footer -->
	
</body>

</html>