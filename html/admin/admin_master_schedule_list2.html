<?
	$Test_No 	= $_GET["No"];
	$month 		= $_GET["month"];
	$ID			= $_GET["ID"];
	$main_title = '한국 스키장 경영협회';
	include '../db_config.html';

	// 관리자가 아니면 member_login.html 페이지로 이동
  	include '../check_rank.php'
?>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Admin Dashboard | (사)한국스키장경영협회</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.ico">
				<link rel="stylesheet" href="./vendor/chartist/css/chartist.min.css">
    <link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<!-- Datatable -->
    <link href="./vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<?
	// if ($The_No){$search_test_no = "and 7G_Master_Apply.Test_No = '$The_No'";}

	if ($ID and $ID != 'all'){$search = "where Test_id = '$ID'";}
	if ($ID == 'all'){$search = "";}

	$query= "select * from 7G_Master_Schedules $search order by Test_Date DESC" ;
	$result=mysql_query($query,$connect );
	$row=mysql_fetch_array($result);

	// $query2= "SELECT * FROM 7G_Skiresort_Member where MEMBER_ID = '$Login_User_ID'" ;
	// $result2=mysql_query($query2,$connect );
	// $login_member=mysql_fetch_array($result2);

	// Head Title 설정
	$Dashboard_Title = '시험일정';
	if ($ID == 'T1'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭1';}
	if ($ID == 'T2'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭2';}
	if ($ID == 'T3'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭3 & 기선전';}
	if ($ID == 'SBT1'){$Dashboard_Title = $Dashboard_Title.' > 스노보드지도요원 티칭1';}
	if ($ID == 'SBT2'){$Dashboard_Title = $Dashboard_Title.' > 스노보드지도요원 티칭1';}
	if ($ID == 'PATROL'){$Dashboard_Title = $Dashboard_Title.' > 스키구조요원';}

?>
</head>
<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->


    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="../index.html" class="brand-logo">
                <img src="../images/sb_logo.png" width = 90%>
            </a>

            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

		<?
		// 챗팅박스 + 헤드네비 불러오기
		include '_chat_box.html';
		include '_head_bar.html';

		// 좌측 네비게이션
	    if ($rank == 9){include '_admin_menu.html';}
	    if ($rank == 8){include '_admin_menu2.html';}
	    ?>


        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- container starts -->
            <div class="container-fluid">
                <!-- row -->

				<?
				echo "
				<div class='row'>
					<div class='col-xl-12'>
						<div class='tab-content'>
							<div id='All' class='tab-pane active fade show'>
								<div class='table-responsive'>


                                            <br><br><br>
											<div class = 'text-center'>
                                            	<span class = 'font32'>(사)한국스키장경영협회 시험일정 ($ID)</span><br>
                                            <br><br><br>";



                                        // T2 검정일정 테이블 헤더
                                        echo "
                                            <table id='example2' class='table card-table display dataTablesCard'>
											<thead>
                                            <tr align=center>
                                                <th width = 150px>시즌&시험장소</th>
                                                <th>분야</th>
                                                <th>시험정보</th>
				<th>응시자</th>
				<th>진행상황</th>
				<th>관리</th>
                                            </tr>
                                        </thead>
										<tbody>";

 		while($row){
 		$i = $i + 1;



	   	$query9 = "SELECT * FROM 7G_Master_Apply WHERE TEST_ID = '$ID' and PAYMENT_STATUS = 2 and TRAN_STATUS = 1 and Test_No = $row[TEST_NO]";

 		$result9=mysql_query($query9,$connect);
		$row9=mysql_fetch_array($result9);
		$total_record9 = mysql_num_rows($result9);


		// 로그인 멤버가 시험에 이미 응시했는지 체크 (티칭1은 결제여부 체크하지 않음, 티칭2 및 티칭3은 결제여부가 결제[2] 완료여야 신청이 완료된 것임)
        
        
		$query3= "select * from 7G_Master_Apply where MEMBER_ID = '$Login_User_ID' and TEST_ID = '$row[Test_id]' and Test_No = $row[TEST_NO] and TRAN_STATUS = 1 and TRAN_STATUS = 2";

 		$result3=mysqli_query($link, $query3);
	 	$total_record3 = mysqli_num_rows($result3);

		if ($row[Skiresort] == 1){$Skiresort = '용평리조트';}
		if ($row[Skiresort] == 2){$Skiresort = '양지파인리조트';}
		if ($row[Skiresort] == 3){$Skiresort = '스타힐리조트';}
		if ($row[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
		if ($row[Skiresort] == 5){$Skiresort = '비발디파크';}
		if ($row[Skiresort] == 6){$Skiresort = '피닉스평창';}
		if ($row[Skiresort] == 7){$Skiresort = '월리힐리파크';}
		if ($row[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
		if ($row[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
		if ($row[Skiresort] == 10){$Skiresort = '오크밸리';}
		if ($row[Skiresort] == 11){$Skiresort = '하이원리조트';}
		if ($row[Skiresort] == 12){$Skiresort = '곤지암리조트';}
		if ($row[Skiresort] == 13){$Skiresort = '알펜시아';}
		if ($row[Skiresort] == 14){$Skiresort = '베어스타운';}
		if ($row[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
		if ($row[Skiresort] == 16){$Skiresort = '오투리조트';}

        //if ($row[Status] == 0){$Status = '접수중';}
        //if ($row[Status] == 1){$Status = '접수완료';}
        //if ($row[Status] == 2){$Status = '시험완료';}

        $dateDifference2 = abs(strtotime($row[Date2]) - strtotime($today));
        $dateDifference1 = abs(strtotime($row[Date1]) - strtotime($today));

 		$Testfee = number_format($row[Testfee]);

     	echo "

			<tr height = 100px style = 'border-bottom:1px solid #b3b3b3;font-size:16px;'>

				<td style = 'font-size:13pt;' align = center width = 200px>
				    $row[TEST_YEAR] - $Skiresort (#$row[TEST_NO])
					<img src = 'resort-icon/$row[Skiresort].jpg' width = 100%><br>
				</td>

				<td style = 'font-size:13pt;' align = center width = 130px>
				";

					if ($row[Test_id] == 'T1'){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>T1</span>";}
					if ($row[Test_id] == 'T2'){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>T2</span>";}
					if ($row[Test_id] == 'T3'){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>T3</span>";}
					if ($row[Test_id] == 'SBT1'){echo "<span class='btn btn-rounded btn-vimeo' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>SB-T1</span>";}
					if ($row[Test_id] == 'SBT2'){echo "<span class='btn btn-rounded btn-vimeo' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>SB-T2</span>";}
					if ($row[Test_id] == 'SBT3'){echo "<span class='btn btn-rounded btn-vimeo' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>SB-T3</span>";}
					if ($row[Test_id] == 'PATROL'){echo "<span class='btn btn-rounded btn-success' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>PATROL</span>";}


				echo "</td>
				<td style = 'font-size:12pt;' align = left width = 320px>
					・ 시험번호 : $row[Test_id]-#$row[TEST_NO]<br>
					・ 시험일자 : $row[Test_Date]<br>
					・ 마감일자 : $row[Expired_Date]<br>
					・ 시험정원 : $row[Participate]명";
				    
				    //if ($row[Participate] >= 50){echo "<span style = 'font-size:11pt;color:red;font-weight:700'> - 백신미접종자 응시불가</span>";}

				echo "<br>
					・ 응시료 : $Testfee 원<br>
            	</td>

				<td style = 'font-size:24pt;color:red;font-weight:600;' align = center width = 100px>
               		$total_record9 명
				</td>


				<td style = 'font-size:13pt;' align = center width = 140px>";

					if ($row[Status] <= 1 ){echo "<span class='btn btn-rounded btn-vimeo' style = 'font-size:13pt;weight:900;width:100px;padding-left:0px;padding-right:0px;'>접수중</span>&nbsp;";}
					if ($row[Status] == 2){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:13pt;weight:900;width:100px;padding-left:0px;padding-right:0px;'>접수마감</span>&nbsp;";}
					if ($row[Status] == 3){echo "<span class='btn btn-rounded btn-success' style = 'font-size:13pt;weight:900;width:100px;padding-left:0px;padding-right:0px;'>시험완료</span>&nbsp;";}
					if ($row[Status] == 9){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:13pt;weight:900;width:100px;padding-left:0px;padding-right:0px;'>접수중지</span>&nbsp;";}


				echo "
				</td>

				<td align = center>

					<a href = 'admin_schedule_edit.html?No=$row[S_No]' class='btn btn-rounded light btn-vimeo' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>수정</a>&nbsp;";
					if ($row[Status] != 9 and $total_record9 > 0){echo "<a href = 'javascript:dele2($row[S_No]);' class='btn btn-rounded light btn-primary' style = 'font-size:13pt;weight:900;width:110px;padding-left:0px;padding-right:0px;'>접수중지</a>&nbsp;";}
					if ($row[Status] != 9 and $total_record9 < 1){echo "<a href = 'javascript:dele($row[S_No]);' class='btn btn-rounded light btn-primary' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>취소</a>&nbsp;";}
					if ($row[Status] == 9){echo "<a href = 'javascript:re_dele($row[S_No]);' class='btn btn-rounded btn-primary' style = 'font-size:13pt;weight:900;width:100px;padding-left:0px;padding-right:0px;'>접수재개</a>";}
					if ($total_record9 > 0 ){echo "<a href = 'admin_master_apply_list.html?ID=$ID&No=$row[TEST_NO]'  class='btn btn-rounded light btn-success' style = 'font-size:13pt;weight:900;width:110px;padding-left:0px;padding-right:0px;'>응시자</a>";}

		echo "</td>
			<tr> ";



 		  $row=mysql_fetch_array($result);

   }

                                   echo "</tbody></table>";


                                   echo "<br>
                                           <div class='form-group text-right'>
                                                <a href='../admin_t2_schedule_regist.html' class='btn btn-outline-primary btn-sm light'>검정일정 신규등록</a>
												--<a href='admin_schedule_regist.html' class='btn btn-outline-primary btn-sm light'>검정일정 신규등록</a>
                                            </div>";

                                ?>
                                          </div>





								</div>
							</div>


        <!--**********************************
            Footer start
        ***********************************-->
        <!-- <div class="footer">
            <div class="copyright">
                <p>© Designed &amp; Developed by podong28.com</a> 2019</p>
            </div>
        </div> -->
        <!--**********************************
            Footer end
        ***********************************-->


    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="./js/custom.min.js"></script>
	<script src="./js/deznav-init.js"></script>

	<!-- Datatable -->
    <script src="./vendor/datatables/js/jquery.dataTables.min.js"></script>
	<script>
		(function($) {
			var table = $('#example2').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example3').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example4').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example5').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			$('#example tbody').on('click', 'tr', function () {
				var data = table.row( this ).data();

			});
		})(jQuery);

	function dele(num) {
   	if (confirm('선택하신 일정이 취소 됩니다.')) {
      location.href = 'admin_delete_schedule.html?S_No='+num;
   	}
   	else {
      alert('취소되었습니다.');
   	}
	}

	function dele2(num) {
		var delConfirm = confirm('응시자가 존재합니다. 그래도 검정일정을 취소하시겠습니까 ?');
		if (delConfirm) {
					alert('검정일정을 취소처리하겠습니다.. 앞으로 응시자의 신청접수가 중단됩니다.');
					location.href = 'admin_delete_schedule.html?S_No='+num;
		}
		else {
					alert('취소요청을 중단하였습니다.');
		}
	}

	function re_dele(num) {
		var delConfirm = confirm('취소중인 검정일정을 재등록하시겠습니까 ?');
		if (delConfirm) {
					alert('취소중인 검정일정을 재등록하겠습니다.. 앞으로 응시자의 신청접수가 재시작됩니다.');
					location.href = 'admin_delete_schedule.html?S_No2='+num;
		}
		else {
					alert('재등록 요청을 중단하였습니다.');
		}
	}



	</script>
</body>
</html>
