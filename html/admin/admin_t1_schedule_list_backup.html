<?

	$The_No 	= $_GET["No"];
	$ID      	= $_GET["ID"];
	$month 		= $_GET["month"];
	$main_title = 'DashBoard | 한국 스키장 경영협회';
	$Dashboard_Title = '스키지도요원 티칭1 검정일정';

	include '../db_config.html';

	if ($ID == 'T1'){$Table_Title = "스키 지도요원 Teaching #1 검정목록";}
	if ($ID == 'SBT1'){$Table_Title = "스노보드 지도요원 Teaching #1 검정목록";}

	// 관리자가 아니면 member_login.html 페이지로 이동
	if ($rank < 7){
	echo " <script>
	alert('잘못된 접근입니다.');
	top.document.location.href = '../member_login.html?MEMBER_ID=$User_ID_Search&Case=9';
	</script>";
	}
?>

<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title><? echo $main_title; ?></title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon.png">
	<link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

<?

	if ($month == '12'){$On12 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2020.12.01' and Date1 <= '2020.12.31' order by Date1 DESC";}
	if ($month == '1'){$On1 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2021.01.01' and Date1 <= '2021.01.31' order by Date1 DESC";}
	if ($month == '2'){$On2 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2021.02.01' and Date1 <= '2021.02.28' order by Date1 DESC";}
	if ($month == '3'){$On3 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2021.03.01' and Date1 <= '2021.03.31' order by Date1 DESC";}


	if ($Login_User_ID  == 'admin_yp' or $Login_User_ID  == 'admin_yp_sb'){$search = "where Test_id = '$ID' and Skiresort = 1"; $place = "용평리조트";}
	if ($Login_User_ID  == 'admin_yj' or $Login_User_ID  == 'admin_yj_sb'){$search = "where Test_id = '$ID' and Skiresort = 2"; $place = '양지파인리조트';}
	if ($Login_User_ID  == 'admin_mj' or $Login_User_ID  == 'admin_mj_sb'){$search = "where Test_id = '$ID' and Skiresort = 4"; $place = '무주덕유산리조트';}
	if ($Login_User_ID  == 'admin_vp' or $Login_User_ID  == 'admin_vp_sb'){$search = "where Test_id = '$ID' and Skiresort = 5"; $place = '비발디파크';}
	if ($Login_User_ID  == 'admin_pp' or $Login_User_ID  == 'admin_pp_sb'){$search = "where Test_id = '$ID' and Skiresort = 6"; $place = '휘닉스평창';}
	if ($Login_User_ID  == 'admin_wh' or $Login_User_ID  == 'admin_wh_sb'){$search = "where Test_id = '$ID' and Skiresort = 7"; $place = '월리힐리파크';}
	if ($Login_User_ID  == 'admin_js' or $Login_User_ID  == 'admin_js_sb'){$search = "where Test_id = '$ID' and Skiresort = 8"; $place = '지산포레스트리조트';}
	if ($Login_User_ID  == 'admin_es' or $Login_User_ID  == 'admin_es_sb'){$search = "where Test_id = '$ID' and Skiresort = 9"; $place = '엘리시안강촌';}
	if ($Login_User_ID  == 'admin_ov' or $Login_User_ID  == 'admin_ov_sb'){$search = "where Test_id = '$ID' and Skiresort = 10"; $place = '오크밸리';}
	if ($Login_User_ID  == 'admin_h1' or $Login_User_ID  == 'admin_h1_sb'){$search = "where Test_id = '$ID' and Skiresort = 11"; $place = '하이원리조트';}
	if ($Login_User_ID  == 'admin_ka' or $Login_User_ID  == 'admin_ka_sb'){$search = "where Test_id = '$ID' and Skiresort = 12"; $place = '곤지암리조트';}
	if ($Login_User_ID  == 'admin_as' or $Login_User_ID  == 'admin_as_sb'){$search = "where Test_id = '$ID' and Skiresort = 13"; $place = '알펜시아';}
	if ($Login_User_ID  == 'admin_bt' or $Login_User_ID  == 'admin_bt_sb'){$search = "where Test_id = '$ID' and Skiresort = 14"; $place = '베어스타운';}
	if ($Login_User_ID  == 'admin_ev' or $Login_User_ID  == 'admin_ev_sb'){$search = "where Test_id = '$ID' and Skiresort = 15"; $place = '에덴벨리리조트';}
	if ($Login_User_ID  == 'admin_o2' or $Login_User_ID  == 'admin_02_sb'){$search = "where Test_id = '$ID' and Skiresort = 16"; $place = '오투리조트';}


	if (!$month){$query= "SELECT * FROM 7G_Master_Schedules $search order by Test_Date DESC" ;}

	// T1 스케쥴 Table 불러오기
	$result = mysqli_query($link, $query);
	$row = mysqli_fetch_array($result);
	$total_record = mysqli_num_rows($result);
?>

</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->


    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="../index.html" class="brand-logo">
                <img src="../images/sb_logo.png" width = 90%>
            </a>

            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

		<?
		// 챗팅박스 + 헤드네비 불러오기
		include '_chat_box.html';
		include '_head_bar.html';

		// 좌측 네비게이션
	    if ($rank == 9){include '_admin_menu.html';}
	    if ($rank == 8){include '_admin_menu2.html';}
   	    if ($rank == 7){include '_admin_menu3.html';}
	    ?>


        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- container starts -->
            <div class="container-fluid">
                <!-- row -->
<?


				echo "
				<div class='row'>
					<div class='col-xl-12'>
						<div class='tab-content'>
							<div id='All' class='tab-pane active fade show'>
								<div class='table-responsive'>


          <br><br><br>
											<div class = 'text-center'>
                                            	<span class = 'font32'>$Table_Title</span>
                                            <br><br><br>";



                                        // T1 검정일정 테이블 헤더
                                        echo "
                                            <table id='example2' class='table card-table display dataTablesCard'>
											<thead>
                                            <tr>
                                                <th width = 180px>장소</th>
                                                <th>세부일정</th>
                                                <th>정원/응시자</th>
                                                <th>검정료</th>
												<th>상태</th>
                                                <th>관리</th>
                                            </tr>
                                        </thead>
										<tbody>";

                 					while($row){
                      $i = $i + 1;

                      $query9 = "SELECT * FROM 7G_Master_Apply WHERE TEST_ID = '$ID' and Test_No = '$row[TEST_NO]'";
                      $result9=mysql_query($query9,$connect);
                      $total_record9 = mysql_num_rows($result9);

                      if ($row[Skiresort] == 1){$Skiresort = '용평리조트';}
                      if ($row[Skiresort] == 2){$Skiresort = '양지파인리조트';}
                      if ($row[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
                      if ($row[Skiresort] == 5){$Skiresort = '비발디파크';}
                      if ($row[Skiresort] == 6){$Skiresort = '휘닉스평창';}
                      if ($row[Skiresort] == 7){$Skiresort = '월리힐리파크';}
                      if ($row[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
                      if ($row[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
                      if ($row[Skiresort] == 10){$Skiresort = '오크밸리';}
                      if ($row[Skiresort] == 11){$Skiresort = '하이원리조트';}
                      if ($row[Skiresort] == 12){$Skiresort = '곤지암리조트';}
                      if ($row[Skiresort] == 13){$Skiresort = '알펜시아';}
                      if ($row[Skiresort] == 14){$Skiresort = '베어스타운';}
                      if ($row[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
                      if ($row[Skiresort] == 16){$Skiresort = '오투리조트';}


																						// 시험 + 검정 상태 표시

                      if ($row[Status] == 0){$Status = '접수중';}
                      if ($row[Status] == 1){$Status = '접수완료';}
                      if ($row[Status] == 2){$Status = '검정완료';}

                      if ($row[Expired_Date] >= $today){$Status = '접수중';}


					  if ($row[Participate] <= $total_record9){$Status = '정원만료';}
					  if ($row[Expired_Date] < $today){$Status = '접수완료';}
					  if ($row[Test_Date] < $today){$Status = '검정완료';}

                      $Test_fee = number_format($row[Testfee]);

                                          // T1 검정일정 데이타 출력
                                          echo  "
												<tr>
													<td style = 'font-size:13pt;' align = center width = 200px>
														<img src = '../admin/resort-icon/$row[Skiresort].jpg' width = 100%>
													</td>
													<td style = 'font-size:13pt;' align = left>
														$Skiresort (검정번호 : #2022-$row[Test_id]-$row[Skiresort]-$row[TEST_NO])<br>
                                                             &nbsp;• 검정일:$row[Test_Date] ($row[Time])<br>
                                                             &nbsp;• 마감일:$row[Expired_Date]
                                                    </td>
													<td style = 'font-size:13pt;' align = center>
		                                                    $row[Participate] 명 / $total_record9 명
                                                    </td>
													<td style = 'font-size:13pt;' align = center>
															$Test_fee
                                                    </td>
													<td style = 'font-size:13pt;' align = center>
	                                                        $Status
                                                    </td>
                                                    <td style = 'font-size:13pt;' align = right>
                                                            <a href = '../admin_schedule_edit.html?ID=T1&No=$row[S_No]' class='btn btn-rounded light btn-vimeo' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>수정</a>&nbsp;";
															if ($row[Status] != 9 and $total_record9 > 0){echo "<a href = 'javascript:dele2($row[S_No]);' class='btn btn-rounded light btn-primary' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>취소</a>&nbsp;";}
															if ($row[Status] != 9 and $total_record9 < 1){echo "<a href = 'javascript:dele($row[S_No]);' class='btn btn-rounded light btn-primary' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>취소</a>&nbsp;";}
															if ($row[Status] == 9){echo "<a href = 'javascript:re_dele($row[S_No]);' class='btn btn-rounded btn-primary' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>재등록</a>";}
                                                            if ($total_record9 > 0 ){echo "<a href = 'admin_master_apply_list.html?ID=$row[Test_id]&No=$row[TEST_NO]'  class='btn btn-rounded light btn-success' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>응시자</a>";}
                                          echo "
                                                    </td>
                                                </tr>";

                                           $row=mysqli_fetch_array($result);

                                           }

                                   echo "</tbody></table>";


                                   echo "<br>
                                           <div class='form-group text-right'>
                                                <a href=../admin_t1_schedule_regist.html class='btn btn-outline-primary btn-sm light'>티칭1 검정일정 신규등록</a>
                                            </div>";

                                ?>
                                          </div>

								</div>
							</div>



        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>© Designed &amp; Developed by <a href="https://7gate.kr/" target="_blank">podong28.com</a> 2019</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->


    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="./js/custom.min.js"></script>
	<script src="./js/deznav-init.js"></script>

	<!-- Datatable -->
    <script src="./vendor/datatables/js/jquery.dataTables.min.js"></script>
	<script>
		(function($) {
			var table = $('#example2').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example3').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example4').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example5').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			$('#example tbody').on('click', 'tr', function () {
				var data = table.row( this ).data();

			});
		})(jQuery);

	function dele(num) {
   	if (confirm('선택하신 일정이 취소 됩니다.')) {
      location.href = 'admin_delete_schedule.html?S_No='+num;
   	}
   	else {
      alert('취소되었습니다.');
   	}
	}

	function dele2(num) {
		var delConfirm = confirm('응시자가 존재합니다. 그래도 검정일정을 취소하시겠습니까 ?');
		if (delConfirm) {
					alert('검정일정을 취소처리하겠습니다.. 앞으로 응시자의 신청접수가 중단됩니다.');
					location.href = 'admin_delete_schedule.html?S_No='+num;
		}
		else {
					alert('취소요청을 중단하였습니다.');
		}
	}

	function re_dele(num) {
		var delConfirm = confirm('취소중인 검정일정을 재등록하시겠습니까 ?');
		if (delConfirm) {
					alert('취소중인 검정일정을 재등록하겠습니다.. 앞으로 응시자의 신청접수가 재시작됩니다.');
					location.href = 'admin_delete_schedule.html?S_No2='+num;
		}
		else {
					alert('재등록 요청을 중단하였습니다.');
		}
	}

	</script>

</body>

</html>
