<?

    extract($_REQUEST);
	$The_No 	= $_GET["No"];
	$month 		= $_GET["month"];
	$ID			= $_GET['ID'];
	$token		= $_GET['token'];

	$main_title = '한국 스키장 경영협회';

	include '../db_config.html';

	// 관리자가 아니면 member_login.html 페이지로 이동
	if ($rank < 7){
	echo " <script>
	alert('접근권한이 없습니다.');
	top.document.location.href = '../member_login.html?MEMBER_ID=$User_ID_Search&Case=9';
	</script>";
	}

	//if (!$token){
	//echo " <script>
	//alert('잘못된 접근 (인증값 오류) 입니다. ');
	//top.document.location.href = '../member_login.html?MEMBER_ID=$User_ID_Search&Case=9';
	//</script>";
	//}

?>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Admin Dashboard | (사)한국스키장경영협회</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.ico">
	<link rel="stylesheet" href="./vendor/chartist/css/chartist.min.css">
    <link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<!-- Datatable -->
    <link href="./vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

<?

			// Head Title 설정
			$Dashboard_Title = '응시자명단';
			if ($ID == 'all'){$Dashboard_Title = $Dashboard_Title.' > 전체';}
			if ($ID == 'T1'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭1'; $ID_No = 1;}
			if ($ID == 'T2'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭2'; $ID_No = 2;}
			if ($ID == 'T3'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭3 & 기선전'; $ID_No = 3;}
			if ($ID == 'SBT1'){$Dashboard_Title = $Dashboard_Title.' > 스노보드지도요원 티칭1'; $ID_No = 4;}
			if ($ID == 'SBT2'){$Dashboard_Title = $Dashboard_Title.' > 스노보드지도요원 티칭2'; $ID_No = 5;}
			if ($ID == 'PATROL'){$Dashboard_Title = $Dashboard_Title.' > 스키구조요원'; $ID_No = 6;}

		if ($The_No){$search_test_no = " and 7G_Master_Apply.Test_No = '$The_No' ";}
		if ($Player){$search_player = " and 7G_Master_Apply.MEMBER_NAME like '%$Player%' "; $search_player2 =" and 7G_Master_Apply.MEMBER_NAME like '%$Player%' ";}

		if ($ID and $ID != 'all'){$search = "where 7G_Master_Apply.TEST_ID = '$ID' and 7G_Master_Apply.PAYMENT_STATUS > 1  and 7G_Master_Apply.tran_status=1 $search_test_no $search_player";}
		if ($ID == 'T1' or $ID == 'SBT1'){$search = "where 7G_Master_Apply.TEST_ID = '$ID' $search_test_no $search_player";}
		if ($ID == 'all'){$search = "";}
		if ($ID == 'T4'){$search = "where 7G_Master_Apply.TEST_ID = 'T3' and 7G_Master_Apply.PAYMENT_STATUS > 1 and 7G_Skiresort_Member.T3_LICENSE = 1 $search_player";}

		// 시험정보불러오기
 		$query9		= "select * from 7G_Master_Schedules where Test_id = '$ID' and TEST_NO = $The_No";
 		$result9	= mysql_query($query9,$connect);
 		$row9		= mysql_fetch_array($result9);

	     // 페이지네이션
     	$test_query	= "select * from 7G_Master_Apply LEFT OUTER JOIN 7G_Skiresort_Member on 7G_Master_Apply.MEMBER_ID = 7G_Skiresort_Member.MEMBER_ID $search $search_player2";
     	$test_result	= mysql_query($test_query, $connect);
     	$total_record = mysql_num_rows($test_result);
 
 
 	     // 실제응시자수
     	//$test_query2	= "select * from 7G_Master_Apply where Test_No = '$The_No' and TRAN_STATUS = 1 and PAYMENT_STATUS > 1" ;
		$test_query2	= "select * from 7G_Master_Apply where test_id='$ID' and Test_No = '$The_No' and TRAN_STATUS = 1 and PAYMENT_STATUS =2" ;
		$test_result2	= mysql_query($test_query2, $connect);
     	$total_record2 = mysql_num_rows($test_result2);

 
 
     	$page = ($_GET['page'])?$_GET['page']:1;
     	if (!$list){$list = 30;}// 페이자당 목록수
     	$show = 10; // 하단 페이지네이션 갯수
 
     	$db_start = ($page - 1) * $list;
    	$db_end = $list;
 



		// $search = "where 7G_Master_Apply.Test_ID = 'PATROL'";
 		$query= "select * from 7G_Master_Apply LEFT OUTER JOIN 7G_Skiresort_Member on 7G_Master_Apply.MEMBER_ID = 7G_Skiresort_Member.MEMBER_ID $search $search_player2 order by 7G_Master_Apply.TEST_ID ASC, 7G_Master_Apply.Apply_No ASC limit $db_start, $db_end";
 		
		$result=mysql_query($query,$connect );
 		$row=mysql_fetch_array($result);

 		$query1= "select * from 7G_Master_Apply where No = '$The_No'";
 		$result1=mysql_query($query1,$connect );
 		$row1=mysql_fetch_array($result1);

		if ($row9[Skiresort] == 1){$Skiresort = '용평리조트';}
		if ($row9[Skiresort] == 2){$Skiresort = '양지파인리조트';}
		if ($row9[Skiresort] == 3){$Skiresort = '스타힐리조트';}
		if ($row9[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
		if ($row9[Skiresort] == 5){$Skiresort = '비발디파크';}
		if ($row9[Skiresort] == 6){$Skiresort = '휘닉스파크';}
		if ($row9[Skiresort] == 7){$Skiresort = '월리힐리파크';}
		if ($row9[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
		if ($row9[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
		if ($row9[Skiresort] == 10){$Skiresort = '오크밸리';}
		if ($row9[Skiresort] == 11){$Skiresort = '하이원리조트';}
		if ($row9[Skiresort] == 12){$Skiresort = '곤지암리조트';}
		if ($row9[Skiresort] == 13){$Skiresort = '알펜시아';}
		if ($row9[Skiresort] == 14){$Skiresort = '베어스타운';}
		if ($row9[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
		if ($row9[Skiresort] == 16){$Skiresort = '오투리조트';}

		// $style001 = "font-size:15;weight:900;width:50px;padding-left:0px;padding-right:0px;padding-top:13px;padding-bottom:13px;border:2px solid #009c47;";
		// $style002 = "font-size:15;weight:900;width:50px;padding-left:0px;padding-right:0px;padding-top:13px;padding-bottom:13px;border:2px solid #ff1e00;";
		$style_gender = "font-size:12;weight:900;padding-left:3px;padding-right:3px;padding-top:0px;padding-bottom:0px;";
?>

</head>
<body>



    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="../index.html" class="brand-logo">
                <img src="../images/sb_logo.png" width = 90%>
            </a>

            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

		<?
		// 챗팅박스 + 헤드네비 불러오기
		include '_chat_box.html';
		include '_head_bar.html';

		// 좌측 네비게이션
	    if ($rank == 9){include '_admin_menu.html';}
	    if ($rank == 8){include '_admin_menu2.html';}
   	    if ($rank == 7){include '_admin_menu3.html';}
	    ?>


        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- container starts -->
            <div class="container-fluid">
                <!-- row -->

				<?
				//echo $query;
				echo "


				<div class='row'>
					<div class='col-xl-12'>
						<div class='tab-content'>
							<div id='All' class='tab-pane active fade show'>
								<div class='table-responsive'>";
											//echo $query;
                                            if ($ID == 'all'){$ID = '전체';}


											echo"
                                            <br><br><br>
                                            <div class = 'text-center'>
                                            	<span class = 'font32'>$ID 검정 응시자 명단</span><br>";

                                            	if ($The_No){echo "<br><span class = 'font24'>($Skiresort #$The_No / $row9[Test_Date] / $total_record2 명 응시)</span>";}

                                            echo "
                                            </div>
                                            <!--br>
                                            <div class = 'text-center'>
                                            <span style = 'font-size:13pt;color:red;font-weight:500;'>
                                            출발리스트 엑셀파일의 사진기능은 2022년 01월 15일 오후 1시경에 정상화될 예정입니다.
                                            </span>
                                            </div-->
                                            <br><br><br>
                                           	<form method='post' action='admin_master_apply_list.html?ID=$ID&No=$The_No'>
                                          	<a href='javascript:excel($ID_No, $The_No)' class='btn btn-primary text-nowrap'><i class='fa fa-file-text scale5 mr-3' aria-hidden='true'></i>채점표 엑셀 다운로드</a>&nbsp";
                                          	
                                          	
                                          	
                                          	if ($total_record2 <= 100){
                                          	echo "                          	
                                            <a href='javascript:excel2($The_No)' class='btn btn-primary text-nowrap'><i class='fa fa-file-text scale5 mr-3' aria-hidden='true'></i>출발리스트 엑셀 다운로드</a>&nbsp";
                                            }
											
											echo "				
                                            <a href='admin_T2_photo.html?No=$No' target = _blank class='btn btn-primary text-nowrap'><i class='fa fa-file-text scale5 mr-3' aria-hidden='true'></i>응시자사진대조표(가나다순)</a>&nbsp";
											
											
											echo "
											<input type='text' class='form-control' value = '$Player' name='Player' placeholder='검색할 성명' style = 'width:200px;font-size:12pt;font-weight:500;padding:5px;text-align:center;'>
											</form>
                                            

									<br>
                                    <table class='table card-table display dataTablesCard'>
                                            <tr>
                                                <td width = 210px>응시자</td>
                                                <td width = 250px>응시자정보</td>
												<td width = 240px>진행상태</td>
                                                <td>시험결과</td>
                                            </tr>";



		//echo $query;
 		while($row){
 		$i = $i + 1;

		if ($row[GENDER] == 1){$GENDER = "<span class='badge badge-pill badge-info' style = '$style_gender'>남</span>";}
		if ($row[GENDER] == 2){$GENDER = "<span class='badge badge-pill badge-danger' style = '$style_gender'>여</span>";}
		if ($row[GENDER] == 3){$GENDER = "<span class='badge badge-pill badge-success' style = '$style_gender'>관</span>";}

		$Testfee = number_format($row[Testfee]);

		$bottom_line = "border-bottom:1px solid #707070;";

		echo "
			<tr>
				<td style = 'font-size:14pt' width = 200px >
					<span>$row[10] <small>($row[MEMBER_ID])</small> $GENDER</span><br>";

				// if ($row[PHOTO3]){$img_url = "../data/$row[PHOTO3]";}
				// if (!$row[PHOTO3]){$img_url = "../data/no_image.jpg";}
				// if ($row[image]){$img_url = "../view3.html?id=$row[MEMBER_ID]";}

				$member_imgs_jpg = "../member_imgs/$row[MEMBER_ID]".".jpg";
				$member_imgs_jpeg = "../member_imgs/$row[MEMBER_ID]".".jpeg";
				$member_imgs_png = "../member_imgs/$row[MEMBER_ID]".".png";
				$member_imgs_gif = "../member_imgs/$row[MEMBER_ID]".".gif";

				if ($row[PHOTO3]){$img_url = "../data/".$row[PHOTO3];}else{$img_url='../data/no_image.jpg';}

				if (is_file($member_imgs_jpg)){$img_url ="$member_imgs_jpg";}
				if (is_file($member_imgs_jpeg)){$img_url ="$member_imgs_jpeg";}
				if (is_file($member_imgs_png)){$img_url ="$member_imgs_png";}
				if (is_file($member_imgs_gif)){$img_url ="$member_imgs_gif";}



		// if ($row[PHOTO3]){$img = "<img src = '../data/$row[PHOTO3]' class = 'border border-dark img-thumbnail rounded-lg' width = 100%>";}
		// if (!$row[PHOTO3]){$img = "<img src = '../data/no_image.jpg' class = 'border border-dark img-thumbnail rounded-lg' width = 100%>";}
		// if ($row[image]){$img = "<img src = '../view3.html?id=$row[MEMBER_ID]' class = 'border border-dark img-thumbnail rounded-lg' width = 100%>";}

		if($rank == 9){$img = "<a href = 'admin_member_edit.html?No=$row[NO]'>$img</a>"; }

		echo "<img src = '$img_url' width = 90%>
	    	 	</td>

				<td style = 'font-size:13pt'align = left>
					• $row[PHONE]<br>
					• 응시번호 : $row[TEST_ID]-$row[Test_No]-$row[Apply_No]<br>
					• 신청일자 : $row[Apply_date]<br>
					• 생년월일 : $row[BIRTH]<br>
					• 비브번호 : $row[BibNo]<br>
				</td>
				
			<td style = 'font-size:14pt' width = 120px align = center>";

					if ($row[TRAN_STATUS] == 1 and $row[PAYMENT_STATUS] == 0){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>BIB미지급</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 1 and $row[PAYMENT_STATUS] == 2){echo "<a href='javascript:BibYn($row[Apply_No]);'><span class='btn btn-rounded btn-vimeo' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>BIB지급</span></a><span id='user-availability-status$row[Apply_No]' style='font-weight:700;'>$row[BibYn]</span>&nbsp;";}

					if ($row[TRAN_STATUS] == 1){echo "<span class='btn btn-rounded btn-success' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>신청완료</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 2){echo "<span class='btn btn-rounded btn-info' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>취소완료</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 3){echo "<span class='btn btn-rounded btn-success' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>환불완료</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 4){echo "<span class='btn btn-rounded btn-success' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>불참</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 5){echo "<span class='btn btn-rounded btn-success' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>검정참석</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 7){echo "<span class='btn btn-rounded btn-success' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>검정완료</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 8){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>검정완료</span>&nbsp;";}
					if ($row[TRAN_STATUS] == 9){echo "<span class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:110px;padding-left:0px;padding-right:0px;'>검정완료</span>&nbsp;";}

			echo "
			</td>
			<td align = center>";

			// 관리화면
			if ($row[TRAN_STATUS] == 1 and ($row[PAYMENT_STATUS] == 0 or !$row[PAYMENT_STATUS])){echo "<a href = 'admin_t1_payment.html?No=$row[Apply_No]&Test_No=$The_No&page=$page' class='btn btn-rounded btn-primary' style = 'font-size:16;weight:900;width:120px;padding-left:0px;padding-right:0px;'>BIB지급</a>";}

			if ($row[PAYMENT_STATUS] == 2 and $row[TRAN_STATUS] == 5){echo "<a href = 'javascript:pass($row[Apply_No]);' class='btn btn-rounded light btn-primary' style = 'font-size:18pt;weight:900;width:120px;padding-left:0px;padding-right:0px;'>합격등록</a>&nbsp;";}

			if ($row[TRAN_STATUS] == 9){echo "<button type='button' class='btn btn-rounded light btn-success' style = 'font-size:18pt;weight:900;width:120px;padding-left:0px;padding-right:0px;'>합격확정</button><br>$row[License_No]";}

	echo "	</td>
		</tr>";

 		  $row=mysql_fetch_array($result);
   		}

   echo "</tbody></table><br>
   ";
?>

										</tbody>
									</table>
								</div>
							</div>





                <!-- Row ends -->
            </div>
            <!-- container ends -->
        </div>
        <!--**********************************
                Content body end
            ***********************************-->
<?

                // 페이징
                $max_page1 = floor($total_record / $list);
                $max_page2 = $total_record / $list;
                if ($max_page2 > $max_page1){$max_page = $max_page1 + 1;}else{$max_page = $max_page1;}
                if ($page>$max_page){$page = $max_page;}
                $previous = $page - 1;
                $next = $page + 1;
                if ($next>$max_page){$next = $max_page;}
                if ($previous<1){$previous = 1;}
                $page_start = (($page - 1) * $list );
                if ($page_start <= 0){$page_start = 0;}
                $page_end = $page_start + $list;
            
                $total_record = number_format($total_record);
            
                echo "
                <div class='copyright'>
                <nav aria-label='...'>
                <ul class='pagination justify-content-center'>
                    <li class='page-item'><a class='page-link' href='?page=$previous&list2=$list&ID=$ID&No=$The_No'>Previous</a></li>";
            
                    $show_end_page = $page+($show/2);
                    $show_start_page = $page-($show/2);

                    if ($show_start_page < 0){$show_start_page = 1;}
                    if ($show_end_page > $max_page){$show_end_page = $max_page + 1;}
                    if ($max_page <= $show){$show_start_page = 1;}
                
                    for($i=$show_start_page; $i<$show_end_page; $i++)
                        {
                            if($page == $i){echo "<li class='page-item active' aria-current='page'><a class='page-link' href='?page=$i&list2=$list&ID=$ID&No=$The_No'>$i<span class='sr-only'>(current)</span><a></li>";}
                            else{echo "<li class='page-item'><a class='page-link' href='?page=$i&list2=$list&ID=$ID&No=$The_No'>$i</a></li>";}                            
                        }
                        echo "<li class='page-item'><a class='page-link' href='?page=$next&list2=$list&ID=$ID&No=$The_No'>Next</a></li>
                
                    </ul>
                </nav>
                </div>";
            ?>




        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>© Designed &amp; Developed by <a href="https://7gate.kr/" target="_blank">podong28.com</a> 2019</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->


    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="./js/custom.min.js"></script>
	<script src="./js/deznav-init.js"></script>

	<!-- Datatable -->
    <script src="./vendor/datatables/js/jquery.dataTables.min.js"></script>
	<script>
function BibYn(no) {
	// alert(no);
	// $("#loaderIcon").show();
	jQuery.ajax({
	url: "check_BibYn.php",
	data:'apply_no='+no,
	type: "GET",
	success:function(data){
		$("#user-availability-status"+no).html(data);
		// $("#loaderIcon").hide();
	},
		error:function (){}
	});
}


		function excel(num1, num2){
		top.document.location.href = '_Excel_L1_Empty_Score_Table.html?ID='+num1+'&No='+num2;
		}
		
		function excel2(num){
		top.document.location.href = '_excel_01.html?No='+num;
		}

		function excel1p(num){
		top.document.location.href = '_excel_t1_start_list_1p.html?No='+num;
		}

		function excel2p(num){
		top.document.location.href = '_excel_t1_start_list_2p.html?No='+num;
		}

	function pass(num) {
   	if (confirm('선택하신 응시자를 합격처리하시겠습니까 ?')) {
       <? echo "location.href = 't1_test_individual_result_insert.php?page=$page&No='+num;"; ?>
   	}
   	else {
      alert('처리가 취소되었습니다.');
   	}
	}
		
		
	</script>
</body>
</html>
