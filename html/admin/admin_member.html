<?php

// MEMBER_NAME ASC 으로 정렬됨. 미친거다.이건..v221231

	$The_No 		= $_GET["SNo"];
	$month 			= $_GET["month"];
	$category 		= $_GET["category"];
	$list 			= $_POST["list"];
	$Player_search 	= $_POST["Player"];
	$Year_search 	= $_POST["Year"];
	$Phone_search 	= $_POST["Phone"];
	$Birth_search 	= $_POST["Birth"];
	$list2 			= $_GET["list2"];
	$Gender_search 	= $_POST["GENDER"];
	$Gender_search2 = $_GET["GENDER2"];
	$Photo 			= $_POST["PHOTO"];
	$Photo2 		= $_GET["PHOTO2"];
		
	
	$Phone_search = align_tel($Phone_search);
	if ($Phone_search == '-'){$Phone_search = '';} 
	
	function align_tel($telNo)
    {
        $telNo = preg_replace('/[^\d\n]+/', '', $telNo);
        if (substr($telNo, 0, 1)!="0" && strlen($telNo)>8) {
            $telNo = "0".$telNo;
        }
        $Pn3 = substr($telNo, -4);
        if (substr($telNo, 0, 2)=="01") {
            $Pn1 =  substr($telNo, 0, 3);
        } elseif (substr($telNo, 0, 2)=="02") {
            $Pn1 =  substr($telNo, 0, 2);
        } elseif (substr($telNo, 0, 1)=="0") {
            $Pn1 =  substr($telNo, 0, 3);
        }
        $Pn2 = substr($telNo, strlen($Pn1), -4);
        if (!$Pn1) {
            return $Pn2."-".$Pn3;
        } else {
            return $Pn1."-".$Pn2."-".$Pn3;
        }
    }

	if(!$list and $list2){$list = $list2;}
	if($_POST["GENDER1"]){$Gender_search = $_POST["GENDER1"];}
	if($_GET["GENDER2"] and !$_POST["GENDER1"]){$Gender_search = $_GET["GENDER2"];}
	
	if($_POST["PHOTO"]){$Photo_search = $_POST["PHOTO"];}
	if($_GET["PHOTO2"] and !$_POST["PHOTO"]){$Photo_search = $_GET["PHOTO2"];}

	echo $Gender_search;

	$main_title = 'Admin Dashboard | (사)한국스키장경영협회';
	
	// Head Title 설정
	$Dashboard_Title = '온라인 회원 관리';
	if ($category == '1'){$Dashboard_Title = $Dashboard_Title.' > 남성회원';}
	if ($category == '2'){$Dashboard_Title = $Dashboard_Title.' > 여성회원';}
	if ($category == '4'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭1';} 
	if ($category == '5'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭2';} 
	if ($category == '6'){$Dashboard_Title = $Dashboard_Title.' > 스키지도요원 티칭3';}                
	if ($category == '7'){$Dashboard_Title = $Dashboard_Title.' > 스노보드-지도요원 티칭1';} 
	if ($category == '8'){$Dashboard_Title = $Dashboard_Title.' > 스노보드-지도요원 티칭2';} 
	if ($category == '9'){$Dashboard_Title = $Dashboard_Title.' > 스키구조요원';}                
	if ($category == '10'){$Dashboard_Title = $Dashboard_Title.' > 티칭#3 심사위원';}                
	if ($category == '21'){$Dashboard_Title = $Dashboard_Title.' > 관리자';}                
	if ($category == '23'){$Dashboard_Title = $Dashboard_Title.' > 회원가입/전환현황 (전체)';}                      
	if ($category == '24'){$Dashboard_Title = $Dashboard_Title.' > 회원가입/전환현황 (최근7일간)';}                

// --------------------------------쿼리----------------------------------------------
	include '../db_config.html';
	
	// 관리자가 아니면 member_login.html 페이지로 이동
 include '../check_rank.php';
	


$sql    = "SELECT count(*) cnt FROM 7G_Skiresort_Member where rank < 8" ;
$result	= mysqli_query($link,$sql);
$total_member = mysqli_fetch_array($result)[cnt];
$total_member = number_format($total_member)." 명";

?>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title><? echo $main_title; ?></title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.ico">
	<link rel="stylesheet" href="./vendor/chartist/css/chartist.min.css">
    <link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<!-- Datatable -->
    <link href="./vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
	<style>.card-img-top {width: 100%;height: 350px;object-fit: cover;}</style>
	<style>.form-control{border-radius: $radius; background: $white; border: 1px solid $border; font-size:13pt; color: #f54242; height: 56px; @include respond('laptop') { height: 41px; } &:hover,&:focus,&.active{ box-shadow: none; background: $white; color: $dark; } }</style>
<body>
<?
	if($Gender_search == '1'){$cheched_1 = 'checked';}
	if($Gender_search == '2'){$cheched_2 = 'checked';}
	if($Gender_search == '4'){$cheched_4 = 'checked';}
	if($Photo == '1' or $Photo2 == 1){$Photo_cheched = 'checked';}
	
	
	$page = ($_GET['page'])?$_GET['page']:1;
	if (!$list){$list = 100;}// 페이자당 목록수
	$show = 10; // 하단 페이지네이션 갯수

  $db_start = ($page - 1) * $list;
	$db_end = $list;
	$main_title = '한국 스키장 경영협회';
	// include '../db_config.html';

	$table_title = '온라인 회원';
	if ($category == '1'){$category_active1 = 'selected'; $table_title = '온라인 회원'; }
	if ($category == '2'){$category_active2 = 'selected'; $table_title = '온라인 회원';}
	if ($category == '3'){$category_active3 = 'selected'; $table_title = '온라인 회원';}
	if ($category == '4'){$category_active4 = 'selected'; $table_title = '스키 티칭1';}
	if ($category == '5'){$category_active5 = 'selected'; $table_title = '스키 티칭2';}
	if ($category == '6'){$category_active6 = 'selected'; $table_title = '스키 티칭3';}
	if ($category == '7'){$category_active7 = 'selected'; $table_title = '스노보드 티칭1';}
	if ($category == '8'){$category_active8 = 'selected'; $table_title = '스노보드 티칭2';}
	if ($category == '9'){$category_active9 = 'selected'; $table_title = '스키구조요원';}
	if ($category == '10'){$category_active10 = 'selected'; $table_title = '티칭3 심사요원';}
	if ($category == '21'){$category_active21 = 'selected'; $table_title = '관리자';}
	if ($category == '23'){$category_active23 = 'selected'; $table_title = '회원가입/전환현황 (전체)';}
	if ($category == '24'){$category_active24 = 'selected'; $table_title = '회원가입/전환현황 (최근7일간)';}

	if (!$category){$category_active0= 'active';}

	if (!$category or $categiry = '')
	{

		$search0 = "where RANK < 8";		//관리자 빼기
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		
		if($Year_search){$search2 = " and (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}
		if(!$Player_search and $Year_search){$search2 = " and (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}

		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}

		if(($Year_search or $Player_search) and $Gender_search == 4){$search3 = " and GENDER = ''";}
		if((!$Year_search and !$Player_search) and $Gender_search == 4){$search3 = " and GENDER = ''";}
		
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select count(*) cnt from 7G_Skiresort_Member $search" ;
		$result	= mysqli_query($link,$query1);
		$total_record = mysqli_fetch_array($result)[cnt];		//where 적용


		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end" ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
	}
	
	if ($category == '1')
	{
		$search0 = " where GENDER = 1 and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and T1_YEAR = $Year_search";}
		
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}
	
	if ($category == '2')
	{
		$search0 = " where GENDER = 2 and RANK <8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and T1_YEAR = $Year_search";}
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}


	if ($category == '3')
	{
		$search0 = "where RANK <8 and ((T1_LICENSE = '' and T2_LICENSE = '' and T3_LICENSE = '' and SBT1_LICENSE = '' and SBT2_LICENSE = '' and PATROL_LICENSE = '') or (T1_LICENSE is NULL and T2_LICENSE is NULL and T3_LICENSE is NULL and SBT1_LICENSE is NULL and SBT2_LICENSE is NULL and PATROL_LICENSE is NULL ))";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		
		if($Year_search){$search2 = " and ((T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search') or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search') or (T1_LICENSE is NULL and T2_LICENSE is NULL and T3_LICENSE is NULL and SBT1_LICENSE is NULL and SBT2_LICENSE is NULL and PATROL_LICENSE is NULL ))";}
		if(!$Player_search and $Year_search){$search2 = " ((T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search') or PATROL_YEAR = '$Year_search') or (T1_LICENSE is NULL and T2_LICENSE is NULL and T3_LICENSE is NULL and SBT1_LICENSE is NULL and SBT2_LICENSE is NULL and PATROL_LICENSE is NULL ))";}

		if(($Year_search or $Player_search) and $Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if((!$Year_search and !$Player_search) and $Gender_search){$search3 = " GENDER = '$Gender_search'";}

		if(($Year_search or $Player_search) and $Gender_search == 4){$search3 = " and GENDER = ''";}
		if((!$Year_search and !$Player_search) and $Gender_search == 4){$search3 = " GENDER = ''";}
		
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$connect=mysql_connect("dbserver","skiresort","ll170505");
		mysql_select_db( "skiresort",$connect);
		
 		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		// $query= "select * from 7G_Skiresort_Member a left join 7G_T_Reserve_Info b on a.PHONE=b.ADD_TEL and a.MEMBER_NAME=b.ADD_NAME_KOR $search order by a.MEMBER_NAME ASC limit $db_start, $db_end" ;
 		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end  " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}



	if ($category == '4')
	{
		$search0 = " where T1_LICENSE = 1 and RANK < 8";
		if($Player_search){$search1 = " and .MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and T1_YEAR = $Year_search";}
		
		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}

		if($Gender_search == 4){$search3 = " and GENDER = ''";}
		
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

	

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '5')
	{
		$search0 = " where T2_LICENSE = 1 and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and T2_YEAR = '$Year_search'";}
		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}
		
		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '6')
	{
		$search0 = " where T3_LICENSE = 1 and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and T3_YEAR = '$Year_search'";}
		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '7')
	{
		$search0 = " where SBT1_LICENSE = 1 and RANK < 8";
		if($Player_search){$search1 = " MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and SBT1_YEAR = '$Year_search'";}
		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '8')
	{
		$search0 = " where SBT2_LICENSE = 1 and RANK < 8";
		if($Player_search){$search1 = " MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and SBT2_YEAR = '$Year_search'";}
		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);

	}

	if ($category == '9')
	{
		$search0 = " where PATROL_LICENSE = 1 and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		if($Year_search){$search2 = " and PATROL_YEAR = '$Year_search'";}
		if($Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}

		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '10')
	{
		$connect=mysql_connect("dbserver","skiresort","ll170505");
		mysql_select_db( "skiresort",$connect);

		$query1= "select * from 7G_T_Reserve_New a left join 7G_T_Reserve_Info b on a.rs_seq=b.rs_seq and a.idkey=b.idkey and a.gd_seq=b.gd_seq where a.MEMBER_TYPE = 'skit3_referee' $Player_search_sql $License_year_sql $Gender_sql order by a.RS_BUYER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_T_Reserve_New a left join 7G_T_Reserve_Info b on a.rs_seq=b.rs_seq and a.idkey=b.idkey and a.gd_seq=b.gd_seq where a.MEMBER_TYPE = 'skit3_referee' $Player_search_sql $License_year_sql $Gender_sql order by a.RS_BUYER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '21')
	{
		$connect=mysql_connect("dbserver","skiresort","ll170505");
		mysql_select_db( "skiresort",$connect);

		$query= "select * from 7G_Skiresort_Member where RANK = 9 order by MEMBER_NAME ASC " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result);
	}
	
	if ($category == '22')
	{
		$connect=mysql_connect("dbserver","skiresort","ll170505");
		mysql_select_db( "skiresort",$connect);

		$query= "select * from 7G_Skiresort_Member where RANK = 8 order by MEMBER_NAME ASC " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result);
	}
	


	if ($category == '23')
	{
		$search0 = "where AGREEMENT_DATE > '1901-01-01' and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		
		if($Year_search){$search2 = " and (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}
		if(!$Player_search and $Year_search){$search2 = " (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}

		if(($Year_search or $Player_search) and $Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if((!$Year_search and !$Player_search) and $Gender_search){$search3 = " and GENDER = '$Gender_search'";}

		if(($Year_search or $Player_search) and $Gender_search == 4){$search3 = " and GENDER = ''";}
		if((!$Year_search and !$Player_search) and $Gender_search == 4){$search3 = " GENDER = ''";}

		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}
		
		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}


		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '24')
	{
	
		
		$timestamp = strtotime("-7 days");
		$search_date = date("Y-m-d H:i:s", $timestamp);

		$search0 = "where AGREEMENT_DATE > '$search_date' and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		
		if($Year_search){$search2 = " and (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}
		if(!$Player_search and $Year_search){$search2 = " (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}

		if(($Year_search or $Player_search) and $Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if((!$Year_search and !$Player_search) and $Gender_search){$search3 = " GENDER = '$Gender_search'";}

		if(($Year_search or $Player_search) and $Gender_search == 4){$search3 = " and GENDER = ''";}
		if((!$Year_search and !$Player_search) and $Gender_search == 4){$search3 = " GENDER = ''";}

		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}
	
		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}


		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);
	}

	if ($category == '25')
	{
	
		
		$search_date = date("Y-m-d");

		$search0 = "where AGREEMENT_DATE = '$search_date' and RANK < 8";
		if($Player_search){$search1 = " and MEMBER_NAME like '%$Player_search%'";}
		
		if($Year_search){$search2 = " and (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}
		if(!$Player_search and $Year_search){$search2 = " (T1_YEAR = '$Year_search' or T2_YEAR = '$Year_search' or T3_YEAR = '$Year_search' or SBT1_YEAR = '$Year_search' or SBT2_YEAR = '$Year_search' or SBT3_YEAR = '$Year_search' or PATROL_YEAR = '$Year_search')";}

		if(($Year_search or $Player_search) and $Gender_search){$search3 = " and GENDER = '$Gender_search'";}
		if((!$Year_search and !$Player_search) and $Gender_search){$search3 = " GENDER = '$Gender_search'";}

		if(($Year_search or $Player_search) and $Gender_search == 4){$search3 = " and GENDER = ''";}
		if((!$Year_search and !$Player_search) and $Gender_search == 4){$search3 = " GENDER = ''";}

		if($Phone_search){$search4 = " and PHONE like '%$Phone_search%'";}

		if($search0 or $search1 or $search2 or $search3){$search = $search0.$search1.$search2.$search3.$search4;}


		$query1= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC " ;
		$result1=mysql_query($query1,$connect );

		$query= "select * from 7G_Skiresort_Member $search order by MEMBER_NAME ASC limit $db_start, $db_end " ;
		$result=mysql_query($query,$connect );
		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result1);


	}

	


?>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->


    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="../index.html" class="brand-logo">
                <img src="../images/sb_logo.png" width = 90%>
            </a>

            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->
		
		<?
		// 챗팅박스 + 헤드네비 불러오기
		include '_chat_box.html';
		include '_head_bar.html';

		// 좌측 네비게이션
	    if ($rank == 9){include '_admin_menu.html';}
	    if ($rank == 8){include '_admin_menu2.html';}
	    ?>
	    
	    
        <!--**********************************
            Content body start
        ***********************************-->

		
        <div class="content-body">
            <!-- container starts -->
            <div class="container-fluid">
                <!-- row -->


				<div class="d-flex flex-wrap mb-2 align-items-center justify-content-between">
					<div class="mb-3 mr-3">
						<?php echo "Query check : ".$query; ?>
						<h6 class="fs-16 text-black font-w600 mb-0">총회원 : <? echo $total_member." ".$Gender_search; ?></h6>
						<span class="fs-14">Based SBMK DBMS</span>
					</div>
					
					<? echo "
					<div class='event-tabs mb-3 mr-3'>
						<form method='post' action='admin_member.html?category=$category'>

						<table>
							<tr>
								<td>
									<select class='form-control style-2 default-select mr-3' id='selectbox' onchange='javascript:location.href = this.value;' style = 'width:100%;'>
										<option value = 'admin_member.html' $category_active1>전체 회원명단</option>
										<!--option value = 'admin_member.html?category=1' $category_active1>남성</option-->
										<!--option value = 'admin_member.html?category=2' $category_active2>여성</option-->
										<option value = 'admin_member.html?category=3' $category_active3>티칭없음</option>
										<option value = 'admin_member.html?category=4' $category_active4>스키지도요원 티칭1</option>
										<option value = 'admin_member.html?category=5' $category_active5>스키지도요원 티칭2</option>
										<option value = 'admin_member.html?category=6' $category_active6>스키지도요원 티칭3</option>
										<option value = 'admin_member.html?category=7' $category_active7>스노보드 지도요원 티칭1</option>
										<option value = 'admin_member.html?category=8' $category_active8>스노보드 지도요원 티칭2</option>
										<option value = 'admin_member.html?category=9' $category_active9>스키구조요원</option>
										<!--option value = 'admin_member.html?category=10' $category_active10>스키지도요원 티칭3 심사위원</option-->
										<option value = 'admin_member.html?category=21' $category_active12>관리자</option>
									</select>
								</td>
								<td>
									<input type='text' class='form-control' value = '$list' name='list' placeholder='페이지당 출력 회원수' style = 'font-size:12pt;width:50px;padding:5px;text-align:center;'>
								</td>	

				                <td>
									<input type='text' class='form-control' value = '$Player_search' name='Player' placeholder='검색할 성명' style = 'width:100px;font-size:12pt;font-weight:500;padding:5px;text-align:center;'>
								</td>
				                <td>
									<input class='form-control' type='text' value = '$Year_search' name='Year' placeholder='자격취득 연도' style = 'width:100px;font-size:12pt;padding:5px;text-align:center;'>
								</td>
								<td>
									<input class='form-control' type='text' value = '$Phone_search' name='Phone' placeholder='전화번호(숫자만)' style = 'width:130px;font-size:12pt;padding:5px;text-align:center;'>
								</td>
								
								<td>
									<input class='form-control' type='text' value = '$Birth_search' name='Birth' placeholder='YYYY-MM-DD' style = 'width:150px;font-size:12pt;padding:5px;text-align:center;'>
								</td>


				                <td style = 'vertical-align: middle;'>
									&nbsp;&nbsp;<input type='radio' name='GENDER1' value='1' $cheched_1 style = 'font-size:20pt;width:20px;height:20px;border:1px;'> 남자
									&nbsp;&nbsp;<input type='radio' name='GENDER1' value='2' $cheched_2 style = 'font-size:20pt;width:20px;height:20px;border:1px;'> 여자
									&nbsp;&nbsp;<input type='radio' name='GENDER1' value='4' $cheched_4 style = 'font-size:20pt;width:20px;height:20px;border:1px;'> 성별 미등록
									&nbsp;&nbsp;<input type='checkbox' name='PHOTO' value='1' $Photo_cheched> 사진

									&nbsp;&nbsp;<input type='Submit' class = 'btn btn-primary text-nowrap' value='검색' >
				                </td>
				            </tr>
						</table>";
                        ?>


			            </form>
		            </div>

		        </div>

				<div class="row">
					<div class="col-xl-12">
						<div class="tab-content">
							<div id="All" class="tab-pane active fade show">


								<?
								//echo $query;
									// 페이징
									$total_record  = !$total_record ? 0 : $total_record;
									$max_page1 = floor($total_record / $list);
									$max_page2 = $total_record / $list;
									if ($max_page2 > $max_page1){$max_page = $max_page1 + 1;}else{$max_page = $max_page1;}
									if ($page>$max_page){$page = $max_page;}
									$previous = $page - 1;
									$next = $page + 1;
									if ($next>$max_page){$next = $max_page;}
									if ($previous<1){$previous = 1;}
									$page_start = (($page - 1) * $list );
									if ($page_start <= 0){$page_start = 0;}
									$page_end = $page_start + $list;
								
									echo "
									<div class='text-center' style = 'padding:10px;'>
											<p style = 'font-size:35px;font-weight:600;'>$table_title 리스트</p>
											<p style = 'font-size:18px;font-weight:600;'>(총 ".number_format($total_record)." 명)</p><br>
									</div>
									<!-- $query -->
									";
									

									// 특정한 검색조건에서만 수행하는 조건절
									if (!$category or $category == '1' or $category == '2' or $category == '3' or $category == '4' or $category == '5' or $category == '6' or $category == '7' or $category == '8' or $category == '9' or $category == '21' or $category == '22' or $category == '23' or $category == '24' or $category == '25')
									{ 
									
										echo "<div class = 'row'>
										";
									
										if ($page_end > $total_record) {$page_end = $total_record;}

										$List_No = $page_start + 1;
										$loop_end = $page_end + 1;
										while ($row){
										
										if (!$row[GENDER] or $row[GENDER] == 0){$GENDER = "<span class='btn btn-rounded btn-snapchat' style = 'color:red;font-size:13pt;weight:900;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;'>미</span>";}
										if ($row[GENDER] == 1){$GENDER = "<span class='btn btn-rounded btn-info' style = 'font-size:13pt;weight:900;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;'>남</span>";}
										if ($row[GENDER] == 2){$GENDER = "<span class='btn btn-rounded btn-danger' style = 'font-size:13pt;weight:900;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;'>여</span>";}
										if ($row[GENDER] == 3){$GENDER = "<span class='btn btn-rounded btn-success' style = 'font-size:13pt;weight:900;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;>관</span>";}

										// 사진불러오기 
										
											$member_imgs_jpg = "../member_imgs/$row[MEMBER_ID]".".jpg";
											$member_imgs_jpeg = "../member_imgs/$row[MEMBER_ID]".".jpeg";
											$member_imgs_png = "../member_imgs/$row[MEMBER_ID]".".png";
											$member_imgs_gif = "../member_imgs/$row[MEMBER_ID]".".gif";

											if ($row[PHOTO3]){$img_url = "../data/".$row[PHOTO3];}else{$img_url = '../data/no_image.jpg';}
											if ($row[image]){$img_url = "../view3.html?id=".$row[MEMBER_ID];}

											if (is_file($member_imgs_jpg)){$img_url ="$member_imgs_jpg";}
											if (is_file($member_imgs_jpeg)){$img_url ="$member_imgs_jpeg";}
											if (is_file($member_imgs_png)){$img_url ="$member_imgs_png";}
											if (is_file($member_imgs_gif)){$img_url ="$member_imgs_gif";}
										
											$img = "<img class='card-img-top' src = '$img_url' width = 300px><br>";
															
										
										
										if ($row[BIRTH] == '0000-00-00' or $row[BIRTH] == '1901-01-01' ){$row[BIRTH] = $row[ADD_BIRTH];}
										if (substr($row[MEMBER_ID],0,3) == 'NO_'){$row[MEMBER_ID] = "미등록"; $text_color = 'color:#ff9500;';}
										
										// 짝수칸에 배경색 지정	
										
										
										
										// 이 옵션은 $Photo가 1이 아니고 사진이 있는 경우만 출력하는 옵션
										// if ($img_No == 0){


											echo "<div class='card col-xs-12' style='width:350px;height:600px;'>";
																									
													
														echo "
														<a href=admin_member_edit.html?No=$row[NO]>$img</a>
														<p class = 'card-text font24' style = 'padding-left:10px;'>
														$List_No $row[MEMBER_NAME] ($row[MEMBER_ID]) $GENDER 
														<a class='btn btn-rounded btn-vimeo' href='admin_member_edit.html?No=$row[NO]' style = 'font-size:13pt;weight:900;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;'>관리</a></p>
														";
														if ($row[PHONE]){echo "+ 전화번호 : $row[PHONE]<br>";}
														if ($row[BIRTH]){echo "+ 생년월일 : $row[BIRTH]<br>";}
														if ($row[T1_LICENSE_No]){echo "+ 스키티칭1 : $row[T1_LICENSE_No]<br>";}
														if ($row[T2_LICENSE_No]){echo "+ 스키티칭2 : $row[T2_LICENSE_No]<br>";}
														if ($row[T3_LICENSE_No]){echo "+ 스키티칭3 : $row[T3_LICENSE_No]<br>";}

			
														if ($row[SBT1_LICENSE_No]){echo "+ 보드티칭1 : $row[SBT1_LICENSE_No]<br>";}
														if ($row[SBT2_LICENSE_No]){echo "+ 보드티칭2 : $row[SBT2_LICENSE_No]<br>";}
														if ($row[SBT3_LICENSE_No]){echo "+ 보드티칭3 : $row[SBT3_LICENSE_No]<br>";}
														if ($row[PATROL_LICENSE_No]){echo "+ 구조요원3 : $row[PATROL_LICENSE_No]<br>";}															
															
															
															if (!$row[GENDER] or $row[GENDER] == 0){
															echo "<div class='card-body'>";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=1&SNo=$i&list2=$list&GENDER2=$Gender_search' class='btn btn-rounded btn-info' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>남자</a>&nbsp";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=2&SNo=$i&list2=$list&GENDER2=$Gender_search' class='btn btn-rounded btn-danger' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>여자</a>&nbsp;";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=3&SNo=$i&list2=$list' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>관리자</a>&nbsp;";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=0&SNo=$i&s_photo=8&list2=$list' class='btn btn-rounded btn-dribbble' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>사진편집</a>&nbsp;";
															echo "<a href = '_gender_chage.html?category=$category&page=$page&NO=$row[NO]&gender=0&SNo=$i&s_photo=9&list2=$list' class='btn btn-rounded btn-secondary' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>사진교체</a><br><br>";

															echo "</div>";

															}
															
																
												echo "
												</div>&nbsp;&nbsp;";


											$List_No = $List_No + 1;


											// 이 괄호는 회원사진이 정상일 경우만 보여주는 옵션임.
											// }  
											
											
											$MEMBER_CHECK = $row[PHONE];
											$row=mysql_fetch_array($result);
											$i = $i + 1;		
											
										}  //  반복문
										
										}  // 대괄호
										
																				echo "</div>";





 		if ($category == '10'){
 
 			echo "   
				<!-- Tap Menu -->
				<table class = 'table table-striped' width = 100% >
  					<thead class='thead-dark'>

						<td align = center><b>번호</b></td>
						<td></td>
   						<td align = center><b>성명(영문)</b></td>
   						<td align = center><b>전화번호</b></td>
   						<td align = center><b>생년월일</b></td>
   						<td align = center><b>주소</b></td>
   						<td align = center><b>관리</b></td>

				</th>";
 
 
		if ($page_end > $total_record) {$page_end = $total_record;}

		for($i=$page_start; $i<$page_end; $i++)
  		{

 			if ($row[ADD_NAME_KOR] == ''){$row[ADD_NAME_KOR] = $row[RS_BUYER_NAME];}
			if ($row[ADD_TEL] == ''){$row[ADD_TEL] = $row[RS_BUYER_TEL];}
   			$j = $i + 1;
 	
    		echo "
    	 	<tr>
			<td align = center>$j</td>
			<td>";			

			$photo_url = substr($row[RS_BUYER_PHOTO],0,5);
			
			if($photo_url == "../data")
				{$photo_url2 = '/skiresort';	
					echo "<img src = $photo_url2"."$row[RS_BUYER_PHOTO] width = 100>";
				} 
			elseif($photo_url == "http:")
				{
					echo "<img src = $row[RS_BUYER_PHOTO] width = 100>";
				}


                if($row[RS_BUYERS_NAME_ENG]) {$row[ADD_NAME_ENG] = $row[RS_BUYERS_NAME_ENG];}
                if($row[RS_BUYERS_TEL]) 	{$row[ADD_TEL] = $row[RS_BUYERS_NAME_ENG];}
                if($row[ZIP_CODE]) 			{$row[ADD_ZIPCODE] = $row[ZIP_CODE];}
                if($row[ADDR1]) 			{$row[ADD_ADDR1] = $row[ADDR1];}
                if($row[ADDR2]) 			{$row[ADD_ADDR2] = $row[ADDR2];}


			echo "
			</td>

			<td align = left>
               $row[ADD_NAME_KOR]&nbsp;($row[ADD_NAME_ENG])<br>
				$row[LICENSE_NUM] 
			</td>

			<td align = left>
               $row[ADD_TEL]     
			</td>

			<td align = center>
               $row[ADD_BIRTH]
			</td>
			
			<td align = left>
               $row[ADD_ZIPCODE]<br>
               $row[ADD_ADDR1] $row[ADD_ADDR2]<br>
            </td>
            <td>
				<a class='badge badge-primary' href=admin_member_edit_01.html?No=$row[NO]><font color = white>정보확인</font></a>&nbsp;
 			</td>

		<tr> ";	

 		  $row=mysql_fetch_array($result);
   		}
 
  		 echo( "</table>");
   
		}
  	?>
 
 	<br>

	<?

	echo "
    <div class='copyright'>
	<nav aria-label='...'>
	<ul class='pagination justify-content-center'>
  
		<li class='page-item'>
			<a class='page-link' href='admin_member.html?category=$category&page=$previous&GENDER2=$Gender_search&PHOTO2=$Photo_search&list2=$list'>Previous</a>
    	</li>";
    	
$show_end_page = $page+$show;
$show_start_page = $page;

if ($show_end_page > $max_page){$show_end_page = $max_page + 1;}
if ($max_page <= $show){$show_start_page = 1;}
    	
for($i=$show_start_page; $i<$show_end_page; $i++)
	{
    	if($page == $i)
    		{
    			echo "
    			<li class='page-item active' aria-current='page'>
      				<a class='page-link' href='admin_member.html?category=$category&page=$i&GENDER2=$Gender_search&Year=$Year_search&PHOTO2=$Photo_search&list2=$list'>$i<span class='sr-only'>(current)</span><a>
    			</li>";
   			}
    
    	else
    	
    		{
    			echo "
    		   	<li class='page-item'>
    				<a class='page-link' href='admin_member.html?category=$category&page=$i&GENDER2=$Gender_search&Year=$Year_search&PHOTO2=$Photo_search&list2=$list'>$i</a>
    			</li>";
    		}

	}    
    echo "
    	<li class='page-item'>
      		<a class='page-link' href='admin_member.html?category=$category&page=$next&GENDER2=$Gender_search&PHOTO2=$Photo_search&list2=$list'>Next</a>
    	</li>
    
  </ul>
  
</nav>
</div>
";
?>


            <!-- container ends -->
        </div>
        <!--**********************************
                Content body end
            ***********************************-->


        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <!--<div class="copyright">
                <p>ⓒ Designed &amp; Developed by <a href="https://7gate.kr/" target="_blank">podong28.com</a> 2019</p>
            </div> -->
        </div>
        <!--**********************************
            Footer end
        ***********************************-->
        
        
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="./js/custom.min.js"></script>
	<script src="./js/deznav-init.js"></script>
	

</body>

</html>