<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<link rel="shortcut icon" href="Myicon.png" type="image/x-icon">
    
    <title>스노보드 티칭1 검정신청 | 한국스키장경영협회</title>

<?php
include 'db_config.html';

	if (!$Login_User_ID){echo " <script language='javascript'>
	alert('로그인이 필요한 서비스 입니다.');top.document.location.href = 'member_login.html?case=9'</script>";}

	// GET으로 값 넘거받기
	$Test_No		= $_GET["No"];
	$Test_Type		= $_GET["type"];
	$Date 			= date('Ymd');


	if ($Test_Type == 'T1'){$Test_Name = '스키 티칭1'; $Test_Table = '7G_T1_Schedules'; $Apply_Table = '7G_T1_Apply'; $Product_Name = 'SKI-Teaching1';}
	if ($Test_Type == 'T2'){$Test_Name = '스키 티칭2'; $Test_Table = '7G_T2_Schedules'; $Apply_Table = '7G_T2_Apply'; $Product_Name = 'SKI-Teaching2';}
	if ($Test_Type == 'T3'){$Test_Name = '스키 티칭3 & 기술선수권대회'; $Test_Table = '7G_T3_Schedules'; $Apply_Table = '7G_T3_Apply'; $Product_Name = 'SKI-Teaching3';}

	if ($Test_Type == 'SBT1'){$Test_Name = '스노보드 티칭1'; $Test_Table = '7G_SBT1_Schedules'; $Apply_Table = '7G_SBT1_Apply'; $Product_Name = 'SB-Teaching1';}
	if ($Test_Type == 'SBT2'){$Test_Name = '스노보드 티칭2'; $Test_Table = '7G_SBT2_Schedules'; $Apply_Table = '7G_SBT2_Apply';  $Product_Name = 'SB-Teaching2';}
	if ($Test_Type == 'SBT3'){$Test_Name = '스노보드 티칭3 & 기술선수권대회'; $Test_Table = '7G_SBT3_Schedules'; $Apply_Table = '7G_SBT3_Apply';  $Product_Name = 'SB-Teaching3';}

	// 신청테이블에 이번 신청내용이 등록되어 있는지 체크
	$dup_query	= "SELECT * FROM $Apply_Table where Test_No = '$Test_No' and MEMBER_ID = '$Login_User_ID'";
	$dup_result	= mysql_query($dup_query,$connect);
	$dup_check	= mysql_fetch_array($dup_result);
	$dup_total_record = mysql_num_rows($dup_result);
			
	$query1		= "SELECT * FROM $Test_Table where No = '$Test_No'";
	$result1	= mysql_query($query1,$connect);
	$row1		= mysql_fetch_array($result1);
	
		if ($row1[Skiresort] == 1){$Skiresort = '용평리조트';}
		if ($row1[Skiresort] == 2){$Skiresort = '양지파인리조트';}
		if ($row1[Skiresort] == 3){$Skiresort = '스타힐리조트';}
		if ($row1[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
		if ($row1[Skiresort] == 5){$Skiresort = '비발디파크';}
		if ($row1[Skiresort] == 6){$Skiresort = '피닉스평창';}
		if ($row1[Skiresort] == 7){$Skiresort = '월리힐리파크';}
		if ($row1[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
		if ($row1[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
		if ($row1[Skiresort] == 10){$Skiresort = '오크밸리';}
		if ($row1[Skiresort] == 11){$Skiresort = '하이원리조트';}
		if ($row1[Skiresort] == 12){$Skiresort = '곤지암리조트';}
		if ($row1[Skiresort] == 13){$Skiresort = '알펜시아';}
		if ($row1[Skiresort] == 14){$Skiresort = '베어스타운';}
		if ($row1[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
		if ($row1[Skiresort] == 16){$Skiresort = '오투리조트';}

		$test_date = $row1[Test_Date]." ($row1[Time])";

	$query= "SELECT * FROM 7G_Skiresort_Member where MEMBER_ID = '$Login_User_ID'";
	$result=mysql_query($query,$connect );
	$row=mysql_fetch_array($result);
	
    $goodsAmt = $_POST['Testfee'];
    $BuyerTel = $_POST['PHONE'];
	$BuyerName = $_POST['MEMBER_NAME'];
	$GoodsName = $_POST['PRODUCT_NAME'];
	$BuyerEmail	= $_POST['BuyerEmail'];
	
	$server_ip = $_SERVER['SERVER_ADDR'];	// 서버 IP 가져오기
	$VbankExpDate = date("Ymd", strtotime($day."1 day"));
	$ediDate = date("YmdHis"); // 전문생성일시
	$Moid = "Moid_".date("YmdHis"); 
	
	if ($BuyerName == ''){$BuyerName = "홍길동";}
	if ($BuyerTel == ''){$BuyerTel  = "01040261483";}
	if ($goodsAmt == ''){$goodsAmt = "100000";}
	if ($GoodsName == ''){$GoodsName = "SKI-Teaching1";}

	if ($row9[Apply_date] == ''){$row9[Apply_date] = $today;}

	$row[PHONE] = str_replace('-', '', $row[PHONE]);

	// 상점서명키 (꼭 해당 상점키로 바꿔주세요)
	$merchantKey = "0/4GFsSd7ERVRGX9WHOzJ96GyeMTwvIaKSWUCKmN3fDklNRGw3CualCFoMPZaS99YiFGOuwtzTkrLo4bR4V+Ow==";
	$MID = "SMTPAY001m";		// MID

	//$goodsAmt = "1004";		// 상품금액
	
	$encryptData = base64_encode(md5($ediDate.$MID.$goodsAmt.$merchantKey));
	$returnUrl = "https://tpay.smilepay.co.kr/returnPay.jsp"; // 결제결과를 수신할 가맹점 returnURL 설정
	$retryUrl = "https://tpay.smilepay.co.kr/inform.jsp"; // 가맹점 retryURL 설정

	$DivideInfo = "{'DivideInfo':[{'Amt':'502','MID':'SMTSUB002m','GoodsName':'상품1'},{'Amt':'502','MID':'SMTSUB003m','GoodsName':'상품2'}]}";

?>

<script type="text/javascript">

	function go_back(){top.document.location.href = 'sbt1_schedule_list.html'}

	function goPay() {
	
		var payment = document.getElementById("Payment_Method").value;
		var zip = document.getElementById("sample6_postcode").value;
		var addr2 = document.getElementById("sample6_detailAddress").value;

		if (!payment){alert('결제방법을 선택해주세요 !!!');return;}
		if (!zip){alert('우편번호를 입력해주세요 !!!');return;}
		if (!addr2){alert('상세주소를 입력해주세요 !!!');return;}
	
		myform = document.mobileweb; 
 		myform.action = "https://mobile.inicis.com/smart/payment/";
 		myform.target = "_self";
 		myform.submit(); 

	} 
	
    function sample6_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if(data.userSelectedType === 'R'){
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    document.getElementById('sample6_extraAddress').value = extraAddr;
                
                } else {
                    document.getElementById('sample6_extraAddress').value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('sample6_postcode').value = data.zonecode;
                document.getElementById('sample6_address').value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById('sample6_detailAddress').focus();
            }
        }).open();
    }
		
</script>	
	
</head>
	<? include 'link-files.html'; ?>
<body>
	<? include 'main_nav2.html';
	
	echo "
			<br><br><br><br>
    		<div class='container' style = 'padding:0px;'>
      			<div class='row'>
        			<div class='col-lg-12 text-center'>
          				<p class = 'font32'>한국스키장경영협회 $Test_Name 검정신청 응시료 결제</p>
          				<p class='font12' style = 'color:red;font-weight:700;'>결제과정이 종료되어야 검정신청이 완료됩니다.</p>
        			</div>
      			</div>
      		</div>
			<br><br>

    		<div class='container'>

	<form name='mobileweb' method='post' action='' accept-charset='euc-kr'>
	
	<input type='text' name='P_NEXT_URL' value='http://skiresort.ivyro.net/skiresort/ski/payment_result.html'> 
 
	<input type='text' name='P_INI_PAYMENT' value='CARD'> 
	<input type='text' name='P_RESERVED' value='twotrs_isp=Y&block_isp=Y&twotrs_isp_noti=N'> 
	<input type='text' name='P_MID' value='INIpayTest'> 
	<input type='text' name='P_OID' value='test_oid_123456'>  
	<input type='text' name='P_NOTI_URL' value=''>  
	<input type='text' name='P_HPP_METHOD' value='1'>  

	
	
	
	
	
		<input type='text' name='P_GOODS' maxlength='80' value='$GoodsName' hidden>
		<input type='text' name='MID' maxlength='10' value='$MID' hidden>
		<input name='ReturnURL' size='50' class='input' value='$returnUrl' hidden>
		<input class='form-control' type='text' id = 'member_id' name='MEMBER_ID' value = '$row[MEMBER_ID]' hidden>
		<input type='text' name='RetryURL' maxlength='200' value='$retryUrl' hidden>
		<input type='text' name='ParentEmail' maxlength='60' value='' hidden>
		<input type='text' name='EncryptData' maxlength='40' value='$encryptData' hidden>
		<input type='text' name='OpenType' maxlength='40' value='KR' hidden>
		<input type='text' name='TransType' maxlength='2' value='0' hidden>
		<input type='text' name='MallIP' maxlength='20' value='$server_ip' hidden>
		<input type='text' name='ediDate' maxlength='14' value='$ediDate' hidden>
		<input type='text' name='VbankExpDate' maxlength='8' value='$VbankExpDate' hidden>
		<input type='text' name='Moid' maxlength='64' value='$Moid' hidden>
		<input type='text' name='FORWARD' value='Y' hidden>
		<input type='text' name='DivideInfo' value='$DivideInfo' hidden>
		<input type='hidden' name='merchantKey' value='$merchantKey'>

                <br><br><br><br>
                <table style = 'height:35px;border-bottom:1px solid #888888;' width = 100% >
        		<tr><td class = 'font16' align = center style = 'background-color:#000000;color:#FFFFFF;width:130px;font-weight:700;'>결제자 정보</td><td></td></tr></table><br><br>


                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>성명</button>
  							</div>
								<input class='form-control'  type='text' name='P_UNAME' value = '$row[MEMBER_NAME]' style = 'height:50px;' readonly>
						</div>											
                </div>
                
                <div class='form-group'>
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>핸드폰</button>
  							</div>
								<input class='form-control'  type='text' name='BuyerTel' value = '$row[PHONE]' style = 'height:50px;' readonly>
						</div>											
                </div>
                
                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>이메일</button>
  							</div>
								<input class='form-control'  type='text' name='BuyerEmail' value = '$row[EMAIL]' style = 'height:50px;' readonly>
						</div>											
                </div>

                
                <div class='form-group'>
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>신청일자</button>
  							</div>
								<input class='form-control'  type='text' name='Apply_date' value = '$row9[Apply_date]' style = 'height:50px;' readonly>
						</div>											
                </div>
                
                <br><br>
                
                <table style = 'height:35px;border-bottom:1px solid #888888;' width = 100% >
        		<tr><td class = 'font16' align = center style = 'background-color:#000000;color:#FFFFFF;width:130px;font-weight:700;'>검정&결제내용</td><td></td></tr></table><br><br>
                
                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>결제방법</button>
  							</div>
								<select class='form-control' id = 'Payment_Method' name = 'PayMethod' style = 'height:50px;'>
									<option value = ''>응시료결제방법</option>
									<option value = ''>-----------------------------------</option>
									<option value = 'CARD' selected>신용카드</option>
									<option value = 'VBANK' $Select2_2>가상계좌입금</option>
									<option value = 'BANK' $Select2_3>일반무통장입금</option>
							</select>
						</div>											
                </div>
                
                <div class='form-group'>
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>응시분야</button>
  							</div>
								<input class='form-control'  type='text' id = 'testfee' name='GoodsName' value = '$Product_Name' style = 'height:50px;' readonly>
						</div>											
                </div>

                <div class='form-group'>
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>검정장소</button>
  							</div>
								<input class='form-control'  type='text' id = 'testfee' name='Skiresort' value = '$Skiresort' style = 'height:50px;' readonly>
						</div>											
                </div>

                <div class='form-group'>
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>검정일시</button>
  							</div>
								<input class='form-control'  type='text' id = 'testfee' name='Test_Date' value = '$test_date' style = 'height:50px;' readonly>
						</div>											
                </div>

                <div class='form-group'>
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>응시료/결제금액</button>
  							</div>
								<input class='form-control'  type='text' id = 'testfee' name='P_AMT' value = '$goodsAmt' style = 'height:50px;' readonly>
						</div>											
                </div>



                <br><br>
                <table style = 'height:35px;border-bottom:1px solid #888888;' width = 100% >
        		<tr><td class = 'font16' align = center style = 'background-color:#000000;color:#FFFFFF;width:130px;font-weight:700;'>배송지정보</td><td></td></tr></table><br><br>


                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>우편번호</button>
  							</div>
								<input class='form-control' type='text' name='BuyerPostNo' id='sample6_postcode' value = '$row[ZIP]' placeholder='우편번호' style = 'height:50px;'>&nbsp;&nbsp;<input type='button' class ='btn-orange' onclick='sample6_execDaumPostcode()' value='우편번호 찾기' width='100' style = 'height:50px;'>
						</div>											
                </div>

                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>주소1</button>
  							</div>
								<input class='form-control'  type='text' id='sample6_address' placeholder='주소1' name = 'ADDRESS1' value = '$row[ADDRESS1]' readonly style = 'height:50px;'>
						</div>											
                </div>

                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>상세주소</button>
  							</div>
								<input class='form-control'  type='text' id='sample6_detailAddress'  name = 'ADDRESS2' value = '$row[ADDRESS2]' placeholder='상세주소' style = 'height:50px;'> 
						</div>											
                </div>

                <div class='form-group' >
						<div class='input-group'>
  							<div class='input-group-prepend'>
								<button class='btn btn-info border-dark' type='button' style = 'width:130px;'>참고항목</button>
  							</div>
								<input class='form-control'  type='text' id='sample6_extraAddress' placeholder='참고항목' name = 'ADDRESS3' value = '$row[ADDRESS3]' readonly style = 'height:50px;'>
						</div>											
                </div>

			</div>                
                
                ";

?>


	</form>
</div>
	
	<div class='container text-right' style = 'padding:10px;'>
					&nbsp;<button class='btn-blue' style = 'height:50px;width:100px;' onclick='go_back()';>검정신청취소</button>&nbsp;
					&nbsp;<button class='btn-black' style = 'height:50px;width:100px;' onclick='goPay()';>응시료 결제</button>
	</div>
		
	<br><br><br>

	
<?
if ($dup_total_record == 1){echo "<script>alert('이미 신청이 되어있습니다.')</script>";}

	include 'footer.html';

?>

		</body>
	</html>

