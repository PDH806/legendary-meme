<?
	$The_No 	= $_GET["No"];
	$month 		= $_GET["month"];
	$main_title = 'DashBoard | 한국 스키장 경영협회';
	$Dashboard_Title = '스키지도요원 티칭1 검정일정';

	include '../db_config.html';

	// 관리자가 아니면 member_login.html 페이지로 이동
	if ($rank != 9 and $rank !=8){
	echo " <script>
	alert('잘못된 접근입니다.');
	top.document.location.href = '../member_login.html?MEMBER_ID=$User_ID_Search&Case=9';
	</script>";
	}
?>

<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title><? echo $main_title; ?></title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon.png">
	<link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

<?

	if ($month == '12'){$On12 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2020.12.01' and Date1 <= '2020.12.31' order by Date1 DESC";}
	if ($month == '1'){$On1 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2021.01.01' and Date1 <= '2021.01.31' order by Date1 DESC";}
	if ($month == '2'){$On2 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2021.02.01' and Date1 <= '2021.02.28' order by Date1 DESC";}
	if ($month == '3'){$On3 = 'class="on"';$query = "SELECT * FROM 7G_Master_Schedules WHERE Date1 >= '2021.03.01' and Date1 <= '2021.03.31' order by Date1 DESC";}


	if ($Login_User_ID  == 'admin_yp'){$search = "where Skiresort = 1"; $place = "용평리조트";}
	if ($Login_User_ID  == 'admin_yj'){$search = "where Skiresort = 2"; $place = '양지파인리조트';}
	if ($Login_User_ID  == 'admin_mj'){$search = "where Skiresort = 4"; $place = '무주덕유산리조트';}
	if ($Login_User_ID  == 'admin_vp'){$search = "where Skiresort = 5"; $place = '비발디파크';}
	if ($Login_User_ID  == 'admin_pp'){$search = "where Skiresort = 6"; $place = '휘닉스평창';}
	if ($Login_User_ID  == 'admin_wh'){$search = "where Skiresort = 7"; $place = '월리힐리파크';}
	if ($Login_User_ID  == 'admin_js'){$search = "where Skiresort = 8"; $place = '지산포레스트리조트';}
	if ($Login_User_ID  == 'admin_es'){$search = "where Skiresort = 9"; $place = '엘리시안강촌';}
	if ($Login_User_ID  == 'admin_ov'){$search = "where Skiresort = 10"; $place = '오크밸리';}
	if ($Login_User_ID  == 'admin_h1'){$search = "where Skiresort = 11"; $place = '하이원리조트';}
	if ($Login_User_ID  == 'admin_ka'){$search = "where Skiresort = 12"; $place = '곤지암리조트';}
	if ($Login_User_ID  == 'admin_as'){$search = "where Skiresort = 13"; $place = '알펜시아';}
	if ($Login_User_ID  == 'admin_bt'){$search = "where Skiresort = 14"; $place = '베어스타운';}
	if ($Login_User_ID  == 'admin_ev'){$search = "where Skiresort = 15"; $place = '에덴벨리리조트';}
	if ($Login_User_ID  == 'admin_o2'){$search = "where Skiresort = 16"; $place = '오투리조트';}


	if (!$month){$On0 = 'class="on"';$query= "SELECT * FROM 7G_Master_Schedules $search order by Test_Date DESC" ;}

	// T1 스케쥴 Table 불러오기
	$result=mysqli_query($link, $query);
	$row=mysqli_fetch_array($result);
	$total_record = mysqli_num_rows($result);
?>

</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->


    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="../index.html" class="brand-logo">
                <img src="../images/sb_logo.png" width = 90%>
            </a>

            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

		<?
		// 챗팅박스 + 헤드네비 불러오기
		include '_chat_box.html';
		include '_head_bar.html';

		// 좌측 네비게이션
	    if ($rank == 9){include '_admin_menu.html';}
	    if ($rank == 8){include '_admin_menu2.html';}
	    ?>


        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- container starts -->
            <div class="container-fluid">
                <!-- row -->
<?


				echo "
				<div class='d-flex flex-wrap mb-2 align-items-center justify-content-between'>
					<div class='mb-3 mr-3'>
						<h6 class='fs-16 text-black font-w600 mb-0'>$total_record Total Schdeduls</h6>
						<span class='fs-14'>Based SBAK DBMS System</span>
					</div>
					<div class='event-tabs mb-3 mr-3'>
						<ul class='nav nav-tabs' role='tablist'>
							<li class='nav-item'>
								<a class='nav-link active' data-toggle='tab' href='#All' role='tab' aria-selected='true'>
									All
								</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-toggle='tab' href='#Paid' role='tab' aria-selected='false'>
									시험예정
								</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-toggle='tab' href='#Not_Paid' role='tab' aria-selected='false'>
									시험완료
								</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-toggle='tab' href='#Canceled' role='tab' aria-selected='false'>
									시험취소
								</a>
							</li>
						</ul>
					</div>
					<div class='d-flex mb-3'>
						<select class='form-control style-2 default-select mr-3'>
							<option>최신순</option>
							<option>이번달</option>
							<option>이번주</option>
						</select>
						<a href='javascript:void(0)' class='btn btn-primary text-nowrap'><i class='fa fa-file-text scale5 mr-3' aria-hidden='true'></i>엑셀 다운로드</a>
					</div>
				</div>
				<div class='row'>
					<div class='col-xl-12'>
						<div class='tab-content'>
							<div id='All' class='tab-pane active fade show'>
								<div class='table-responsive'>


                                            <br><br><br>
											<div class = 'text-center'>
                                            	<span class = 'font32'>스키지도요원 Teaching #1 시험일정</span>
                                            <br><br><br>";



                                        // T1 검정일정 테이블 헤더
                                        echo "
                                            <table id='example2' class='table card-table display dataTablesCard'>
											<thead>
                                            <tr>
                                                <th width = 180px>장소</th>
                                                <th>세부일정</th>
                                                <th>정원/응시자</th>
                                                <th>검정료</th>
												<th>상태</th>
                                                <th>관리</th>
                                            </tr>
                                        </thead>
										<tbody>";

                                         while($row){
                                          $i = $i + 1;

																					// 응시자수 구하기
																					if ($row[Test_id] == 'T1' or $row[Test_id] == 'SBT1')
																				  {$query9 = "SELECT * FROM 7G_Master_Apply WHERE TEST_ID = '$row[Test_id]' and TRAN_STATUS >= 1 and Test_No = $row[TEST_NO]";}
																					   else
																				  {$query9 = "SELECT * FROM 7G_Master_Apply WHERE TEST_ID = '$row[Test_id]' and PAYMENT_STATUS > 1 and Test_No = $row[TEST_NO]";}

																					$result9=mysql_query($query9,$connect);
																					$row9=mysql_fetch_array($result9);
																					$total_record9 = mysql_num_rows($result9);

                                          if ($row[Skiresort] == 1){$Skiresort = '용평리조트';}
                                          if ($row[Skiresort] == 2){$Skiresort = '양지파인리조트';}
                                          if ($row[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
                                          if ($row[Skiresort] == 5){$Skiresort = '비발디파크';}
                                          if ($row[Skiresort] == 6){$Skiresort = '피닉스평창';}
                                          if ($row[Skiresort] == 7){$Skiresort = '월리힐리파크';}
                                          if ($row[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
                                          if ($row[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
                                          if ($row[Skiresort] == 10){$Skiresort = '오크밸리';}
                                          if ($row[Skiresort] == 11){$Skiresort = '하이원리조트';}
                                          if ($row[Skiresort] == 12){$Skiresort = '곤지암리조트';}
                                          if ($row[Skiresort] == 13){$Skiresort = '알펜시아';}
                                          if ($row[Skiresort] == 14){$Skiresort = '베어스타운';}
                                          if ($row[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
                                          if ($row[Skiresort] == 16){$Skiresort = '오투리조트';}

                                          if ($row[Status] == 0){$Status = '접수중';}
                                          if ($row[Status] == 1){$Status = '접수완료';}
                                          if ($row[Status] == 2){$Status = '검정완료';}

                                		  $dateDifference2 = abs(strtotime($row[Date2]) - strtotime($today));
                                		  $dateDifference1 = abs(strtotime($row[Date1]) - strtotime($today));

                                          if ($dateDifference2 >= 0){$Status = '접수중';}
										  if ($dateDifference2 < 0){$Status = '접수완료';}
                                          if ($dateDifference1 < 0){$Status = '검정완료';}

                                          $Test_fee = number_format($row[Testfee]);

                                          // T1 검정일정 데이타 출력
                                          echo  "
												<tr>
													<td style = 'font-size:13pt;' align = center width = 200px>
														<img src = 'resort-icon/$row[Skiresort].jpg' width = 100%>
													</td>
													<td style = 'font-size:13pt;' align = left>
														$Skiresort (검정번호 : $row[No]) $row[Test_id]<br>
                                                             &nbsp;• 검정일:$row[Test_Date] ($row[Time])<br>
                                                             &nbsp;• 마감일:$row[Expired_Date]
                                                    </td>
													<td style = 'font-size:13pt;' align = center>
		                                                    $row[Participate] 명 / $total_record9 명
                                                    </td>
													<td style = 'font-size:13pt;' align = center>
															$Test_fee
                                                    </td>
													<td style = 'font-size:13pt;' align = center>
	                                                        $Status
                                                    </td>
                                                    <td style = 'font-size:13pt;' align = right>
                                                            <a href = '../admin_t1_schedule_edit.html?No=$row[No]' class='btn btn-rounded light btn-vimeo' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>수정</a>&nbsp;
                                                       		<a href = 'javascript:dele($row[No])' class='btn btn-rounded light btn-primary' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>삭제</a>&nbsp;";
                                                            if ($total_record9 > 0 ){echo "<a href = 'admin_master_apply_list.html?ID=T1&No=$row[No]'  class='btn btn-rounded light btn-success' style = 'font-size:13pt;weight:900;width:80px;padding-left:0px;padding-right:0px;'>응시자</a>";}
                                          echo "
                                                    </td>
                                                </tr>";

                                           $row=mysqli_fetch_array($result);

                                           }

                                   echo "</tbody></table>";


                                   echo "<br>
                                           <div class='form-group text-right'>
                                                <a href=../admin_t1_schedule_regist.html class='btn btn-outline-primary btn-sm light'>티칭1 검정일정 신규등록</a>
                                            </div>";

                                ?>
                                          </div>

								</div>
							</div>



        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>© Designed &amp; Developed by <a href="https://7gate.kr/" target="_blank">podong28.com</a> 2019</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->


    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="./js/custom.min.js"></script>
	<script src="./js/deznav-init.js"></script>

	<!-- Datatable -->
    <script src="./vendor/datatables/js/jquery.dataTables.min.js"></script>
	<script>
		(function($) {
			var table = $('#example2').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example3').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example4').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			var table = $('#example5').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,
				lengthChange:false

			});
			$('#example tbody').on('click', 'tr', function () {
				var data = table.row( this ).data();

			});
		})(jQuery);

	function dele(num) {
   	if (confirm('선택하신 일정이 삭제됩니다.')) {
      location.href = 'admin_delete_schedule.html?category=T1&No='+num;
   	}
   	else {
      alert('삭제가 취소되었습니다.');
   	}
	}
	</script>

</body>

</html>
