<?
	$The_No 	= $_GET["No"];
	$month 		= $_GET["month"];
	$main_title = '한국 스키장 경영협회';
	include '../db_config.html';
	
	// 관리자가 아니면 member_login.html 페이지로 이동
	if ($rank != 9 and $rank !=8){
	echo " <script>
	alert('잘못된 접근입니다.');
	top.document.location.href = '../member_login.html?MEMBER_ID=$User_ID_Search&Case=9';
	</script>";
	}
?>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Admin Dashboard | (사)한국스키장경영협회</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.ico">
	<link rel="stylesheet" href="./vendor/chartist/css/chartist.min.css">
    <link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<!-- Datatable -->
    <link href="./vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

<?
		$connect=mysql_connect("dbserver","skiresort","ll170505");
		mysql_select_db( "skiresort",$connect);
		if ($The_No){$search = "where 7G_SBT2_Apply.Test_No = '$The_No'";}
			
 		$query= "select * from 7G_SBT2_Apply LEFT OUTER JOIN 7G_SBT2_Schedules ON 7G_SBT2_Apply.Test_No = 7G_SBT2_Schedules.No JOIN 7G_Skiresort_Member on 7G_SBT2_Apply.MEMBER_ID = 7G_Skiresort_Member.MEMBER_ID $search order by 7G_SBT2_Apply.Apply_date ASC ";
 		$result=mysql_query($query,$connect );
 		$row=mysql_fetch_array($result);
		$total_record = mysql_num_rows($result);
		
 		$query1= "select * from 7G_SBT2_Schedules where No = '$The_No'";
 		$result1=mysql_query($query1,$connect );
 		$row1=mysql_fetch_array($result1);

		if ($row1[Skiresort] == 1){$Skiresort = '용평리조트';}
		if ($row1[Skiresort] == 2){$Skiresort = '양지파인리조트';}
		if ($row1[Skiresort] == 3){$Skiresort = '스타힐리조트';}
		if ($row1[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
		if ($row1[Skiresort] == 5){$Skiresort = '비발디파크';}
		if ($row1[Skiresort] == 6){$Skiresort = '피닉스평창';}
		if ($row1[Skiresort] == 7){$Skiresort = '월리힐리파크';}
		if ($row1[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
		if ($row1[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
		if ($row1[Skiresort] == 10){$Skiresort = '오크밸리';}
		if ($row1[Skiresort] == 11){$Skiresort = '하이원리조트';}
		if ($row1[Skiresort] == 12){$Skiresort = '곤지암리조트';}
		if ($row1[Skiresort] == 13){$Skiresort = '알펜시아';}
		if ($row1[Skiresort] == 14){$Skiresort = '베어스타운';}
		if ($row1[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
		if ($row1[Skiresort] == 16){$Skiresort = '오투리조트';}

		$style001 = "font-size:15;weight:900;width:50px;padding-left:0px;padding-right:0px;padding-top:13px;padding-bottom:13px;";
		$style_gender = "font-size:12;weight:900;padding-left:3px;padding-right:3px;padding-top:0px;padding-bottom:0px;";
		
		// 점수 기준
		$cut_line = 70;
		$cut_line_total = 210;

		
?>

</head>
<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->


    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <a href="../index.html" class="brand-logo">
                <img src="../images/sb_logo.png" width = 90%>
            </a>

            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->
		
		<?
		// 챗팅박스 + 헤드네비 불러오기
		include '_chat_box.html';
		include '_head_bar.html';

		// 좌측 네비게이션
	    if ($rank == 9){include '_admin_menu.html';}
	    if ($rank == 8){include '_admin_menu2.html';}
	    ?>
	    
	    
        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- container starts -->
            <div class="container-fluid">
                <!-- row -->

				<?
				echo "
				<div class='d-flex flex-wrap mb-2 align-items-center justify-content-between'>
					<div class='mb-3 mr-3'>
						<h6 class='fs-16 text-black font-w600 mb-0'>$total_record Total Apply</h6>
						<span class='fs-14'>Based SBAK DBMS System</span>
					</div>
					<div class='event-tabs mb-3 mr-3'>
						<ul class='nav nav-tabs' role='tablist'>
							<li class='nav-item'>
								<a class='nav-link active' data-toggle='tab' href='#All' role='tab' aria-selected='true'>
									All
								</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-toggle='tab' href='#Paid' role='tab' aria-selected='false'>
									결제완료
								</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-toggle='tab' href='#Not_Paid' role='tab' aria-selected='false'>
									미결제
								</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-toggle='tab' href='#Canceled' role='tab' aria-selected='false'>
									결과입력
								</a>
							</li>
						</ul>
					</div>
					<div class='d-flex mb-3'>
						<select class='form-control style-2 default-select mr-3'>
							<option>최신순</option>
							<option>이번달</option>
							<option>이번주</option>
						</select>
						<a href='excel.html' class='btn btn-primary text-nowrap'><i class='fa fa-file-text scale5 mr-3' aria-hidden='true'></i>엑셀 다운로드</a>
					</div>
				</div>
				<div class='row'>
					<div class='col-xl-12'>
						<div class='tab-content'>
							<div id='All' class='tab-pane active fade show'>
								<div class='table-responsive'>
								
                                            <br><br><br>
                                            <div class = 'text-center'>
                                            	<span class = 'font32'>스노보드 지도요원 Teaching #2 시험 응시자 명단</span>";
                                            
                                            	if ($The_No){echo "<br><span class = 'font24'>($Skiresort #$The_No / $row1[Test_Date])</span>";} 	
                                            
                                            echo "
                                            </div>                                            
                                            <br><br><br>
								
                                    <table id='example2' class='table card-table display dataTablesCard'>
										<thead>
                                            <tr>
                                                <th width = 250px>응시자</th>
                                                <th>응시자정보</th>
                                                <th>택배주소</th>
												<th width = 150px>진행상태</th>
                                                <th>결과</th>
                                            </tr>
                                        </thead>
										<tbody>";
									
 		while($row){
 		$i = $i + 1;
 		
		if ($row[Skiresort] == 1){$Skiresort = '용평리조트';}
		if ($row[Skiresort] == 2){$Skiresort = '양지파인리조트';}
		if ($row[Skiresort] == 3){$Skiresort = '스타힐리조트';}
		if ($row[Skiresort] == 4){$Skiresort = '무주덕유산리조트';}
		if ($row[Skiresort] == 5){$Skiresort = '비발디파크';}
		if ($row[Skiresort] == 6){$Skiresort = '피닉스평창';}
		if ($row[Skiresort] == 7){$Skiresort = '월리힐리파크';}
		if ($row[Skiresort] == 8){$Skiresort = '지산포레스트리조트';}
		if ($row[Skiresort] == 9){$Skiresort = '엘리시안강촌';}
		if ($row[Skiresort] == 10){$Skiresort = '오크밸리';}
		if ($row[Skiresort] == 11){$Skiresort = '하이원리조트';}
		if ($row[Skiresort] == 12){$Skiresort = '곤지암리조트';}
		if ($row[Skiresort] == 13){$Skiresort = '알펜시아';}
		if ($row[Skiresort] == 14){$Skiresort = '베어스타운';}
		if ($row[Skiresort] == 15){$Skiresort = '에덴벨리리조트';}
		if ($row[Skiresort] == 16){$Skiresort = '오투리조트';}

		if ($row[GENDER] == 1){$GENDER = "<span class='badge badge-pill badge-info' style = '$style_gender'>남</span>";}
		if ($row[GENDER] == 2){$GENDER = "<span class='badge badge-pill badge-danger' style = '$style_gender'>여</span>";}
		if ($row[GENDER] == 3){$GENDER = "<span class='badge badge-pill badge-success' style = '$style_gender'>관</span>";}

 		if ($row[SBT1_Payment] == 0){$Payment = '미결제';}
		if ($row[SBT1_Payment] == 1){$Payment = '결제완료';}

 		if ($row[SBT1_Process] == 1){$Process = '신청';}
		if ($row[SBT1_Process] == 2){$Process = '취소+미환불';}
 		if ($row[SBT1_Process] == 3){$Process = '취소+환불';}
		if ($row[SBT1_Process] == 4){$Process = '불참';}
		if ($row[SBT1_Process] == 5){$Process = '경기참석';}
		if ($row[SBT1_Process] == 7){$Process = '검정완료';}

		$Testfee = number_format($row[Testfee]);
		
		
		if ($row[PHOTO3]){$img = "<img src = '../data/$row[PHOTO3]' class = 'border border-dark img-thumbnail rounded-lg' width = 200px>";}
		if (!$row[PHOTO3]){$img = "<img src = '../data/no_image.jpg' class = 'border border-dark img-thumbnail rounded-lg' width = 200px>";}
		if ($row[image]){$img = "<img src = '../view3.html?id=$row[MEMBER_ID]' class = 'border border-dark img-thumbnail rounded-lg' width = 200px>";}

		$bottom_line = "border-bottom:1px solid #707070;";
		 	
		echo " 	
			<tr>
				<td style = 'font-size:14pt' width = 200px >
					<span>$row[MEMBER_NAME] / $row[MEMBER_ID] $GENDER</span>
	    	 		$img
	    	 	</td>

				<td style = 'font-size:13pt' width = 250px align = left>
					• $row[PHONE]<br> 
					• 응시번호 : $row[Apply_No]<br>
					• 신청일자 : $row[Apply_date]
				</td>
				<td style = 'font-size:13pt' width =300px>
					<span class='badge badge-lg badge-primary'>$row[ZIP]</span><br>
               		&nbsp;$row[ADDRESS1]<br>&nbsp;$row[ADDRESS2]
			</td>
			<td style = 'font-size:14pt' width = 150px align = center>";
			
					if ($row[SBT1_Payment] == 0){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-primary' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>미결제</a>&nbsp;";}
					if ($row[SBT1_Payment] == 1){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-vimeo' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>결제완료</a>&nbsp;";}
			
					if ($row[SBT1_Process] == 1){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>신청완료</a>&nbsp;";}
					if ($row[SBT1_Process] == 2){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>취소신청</a>&nbsp;";}
					if ($row[SBT1_Process] == 3){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>환불완료</a>&nbsp;";}
					if ($row[SBT1_Process] == 4){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>불참</a>&nbsp;";}
					if ($row[SBT1_Process] == 5){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>경기참석</a>&nbsp;";}
					if ($row[SBT1_Process] == 7){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-success' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>시험완료</a>&nbsp;";}

			
			echo "
			</td>
			<td align = right>";
			
			if ($row[SBT1_Payment] == 0){echo "<a href = 'admin_sbt1_payment.html?No=$row[Apply_No]' class='btn btn-rounded btn-primary' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>결제처리</a>";}

			if ($row[SBT1_Process] == 5){echo "<a href = '../sbt1_test_individual_result_input.php?Apply_No=$row[Apply_No]' class='btn btn-rounded btn-primary'>결과등록</a>";}
			
			if ($row[SBT1_Process] == 7){
				if ($row[SBT1_Score1] < $cut_line){$bg_color1 = "btn btn-rounded light btn-danger";} else {$bg_color1 = "btn btn-rounded light btn-success";}
				if ($row[SBT1_Score2] < $cut_line){$bg_color2 = "btn btn-rounded light btn-danger";} else {$bg_color2 = "btn btn-rounded light btn-success";}
				if ($row[SBT1_Score2] < $cut_line){$bg_color3 = "btn btn-rounded light btn-danger";} else {$bg_color3 = "btn btn-rounded light btn-success";}

				if ($row[SBT1_Total_Score] >= $cut_line_total){$row[SBT1_Total_Score] = "합격 : $row[SBT1_Total_Score]"; $bg_color4 = "btn btn-rounded btn-vimeo";} else {$row[SBT1_Total_Score] = "탈락 : $row[SBT1_Total_Score]";  $bg_color4 = "btn btn-rounded btn-pinterest";}

				echo "<button type='button' class='$bg_color1' style = '$style001'>$row[SBT1_Score1]</button>&nbsp;";
				echo "<button type='button' class='$bg_color2' style = '$style001'>$row[SBT1_Score2]</button>&nbsp;";
				echo "<button type='button' class='$bg_color3' style = '$style001'>$row[SBT1_Score3]</button>&nbsp;";
				echo "<button type='button' class='$bg_color4'> $row[SBT1_Total_Score]</button><br><br>";

				echo "<a href = '../sbt1_test_individual_result_input.php?Apply_No=$row[Apply_No]' class='btn btn-rounded btn-info' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>점수수정</a>&nbsp;";
				
				echo "<a href = '../sbt1_test_individual_result_input.php?Apply_No=$row[Apply_No]' class='btn btn-rounded btn-tumblr' style = 'font-size:12;weight:900;width:50px;padding-left:0px;padding-right:0px;'>결과확정</a>";
			}

				
	echo "	</td>
		</tr>";
		
 		  $row=mysql_fetch_array($result);
   		}
		 	 
   echo "</tbody></table><br>
   ";									
									?>	

										</tbody>
									</table>
								</div>
							</div>
							
							
							<div id="Paid" class="tab-pane fade">
								<div class="table-responsive">
                                    <table id="example3" class="table card-table display dataTablesCard">
										<thead>
                                            <tr>
                                            <tr>
                                                <th>회원성명</th>
                                                <th>신청일</th>
                                                <th>License</th>
                                                <th>결제상태</th>
												<th>결제금액</th>
                                                <th>진행상태</th>
                                                <th>택배사</th>
                                                <th>운송장번호</th>
                                                <th>발송일</th>
                                                <th>Total Revenue</th>
                                            </tr>
                                            </tr>
                                        </thead>
										<tbody>
									<?
									
									$License_query	= "SELECT * FROM 7G_License_Renew where PAYMENT_STATUS = '결제완료' ORDER BY MEMBER_NAME DESC ";
									$License_result	= mysqli_query($link, $License_query);
									$row			= mysqli_fetch_array($License_result);

									while($row){
									$row[TRAN_TIME] = substr($row[TRAN_TIME],0,2).":".substr($row[TRAN_TIME],2,2).";".substr($row[TRAN_TIME],4,2);
									if($row[DELIVERY_DATE] == NULL){$row[DELIVERY_DATE] = '미발송';}
										echo "
											<tr>
												<td>$row[MEMBER_NAME]</td>
												<td>$row[TRAN_DATE]<br>$row[TRAN_TIME]</td>
												<td><span class='text-nowrap'>$row[LICENSE_NO]</span></td>
												<td>$row[PAYMENT_STATUS]</td>
												<td>$row[AMOUNT]</td>
												<td>$row[TRAN_STATUS]</td>
												<td>$row[DELIVERY_AGENCY]</td>
												<td>$row[TRACKING_NO]</td>
												<td>$row[DELIVERY_DATE]</td>
												<td><a href='javascript:void(0)' class='btn btn-primary btn-sm light'>$125,70</a></td>
											</tr>";
									
											$row	= mysqli_fetch_array($License_result);


									}
									
									?>	

										</tbody>
									</table>
								</div>
							</div>
							<div id="Not_Paid" class="tab-pane fade">
								<div class="table-responsive">
                                    <table id="example4" class="table card-table display dataTablesCard">
										<thead>
                                            <tr>
                                                <th>회원성명</th>
                                                <th>신청일</th>
                                                <th>License</th>
                                                <th>결제상태</th>
												<th>결제금액</th>
                                                <th>진행상태</th>
                                                <th>택배사</th>
                                                <th>운송장번호</th>
                                                <th>발송일</th>
                                                <th>Total Revenue</th>
                                            </tr>
                                        </thead>
										<tbody>

									<?
									
									$License_query	= "SELECT * FROM 7G_License_Renew where PAYMENT_STATUS = '미결제' ORDER BY MEMBER_NAME DESC ";
									$License_result	= mysqli_query($link, $License_query);
									$row			= mysqli_fetch_array($License_result);

									while($row){
									$row[TRAN_TIME] = substr($row[TRAN_TIME],0,2).":".substr($row[TRAN_TIME],2,2).";".substr($row[TRAN_TIME],4,2);
									if($row[DELIVERY_DATE] == NULL){$row[DELIVERY_DATE] = '미발송';}
										echo "
											<tr>
												<td>$row[MEMBER_NAME]</td>
												<td>$row[TRAN_DATE]<br>$row[TRAN_TIME]</td>
												<td><span class='text-nowrap'>$row[LICENSE_NO]</span></td>
												<td>$row[PAYMENT_STATUS]</td>
												<td>$row[AMOUNT]</td>
												<td>$row[TRAN_STATUS]</td>
												<td>$row[DELIVERY_AGENCY]</td>
												<td>$row[TRACKING_NO]</td>
												<td>$row[DELIVERY_DATE]</td>
												<td><a href='javascript:void(0)' class='btn btn-primary btn-sm light'>$125,70</a></td>
											</tr>";
									
											$row	= mysqli_fetch_array($License_result);


									}
									
									?>	

										</tbody>
									</table>
								</div>
							</div>
							<div id="Canceled" class="tab-pane fade">
								<div class="table-responsive">
                                    <table id="example5" class="table card-table display dataTablesCard">
										<thead>
                                            <tr>
                                                <th>회원성명</th>
                                                <th>신청일</th>
                                                <th>License</th>
                                                <th>결제상태</th>
												<th>결제금액</th>
                                                <th>진행상태</th>
                                                <th>택배사</th>
                                                <th>운송장번호</th>
                                                <th>발송일</th>
                                                <th>Total Revenue</th>
                                            </tr>
                                        </thead>
										<tbody>
									<?
									
									$License_query	= "SELECT * FROM 7G_License_Renew where PAYMENT_STATUS = '결제완료' and TRAN_STATUS = '미발송' ORDER BY MEMBER_NAME DESC ";
									$License_result	= mysqli_query($link, $License_query);
									$row			= mysqli_fetch_array($License_result);

									while($row){
									$row[TRAN_TIME] = substr($row[TRAN_TIME],0,2).":".substr($row[TRAN_TIME],2,2).";".substr($row[TRAN_TIME],4,2);
									if($row[DELIVERY_DATE] == NULL){$row[DELIVERY_DATE] = '미발송';}
									
										echo "
											<tr>
												<td>$row[MEMBER_NAME]</td>
												<td>$row[TRAN_DATE]<br>$row[TRAN_TIME]</td>
												<td><span class='text-nowrap'>$row[LICENSE_NO]</span></td>
												<td>$row[PAYMENT_STATUS]</td>
												<td>$row[AMOUNT]</td>
												<td>$row[TRAN_STATUS]</td>
												<td>$row[DELIVERY_AGENCY]</td>
												<td>$row[TRACKING_NO]</td>
												<td>$row[DELIVERY_DATE]</td>
												<td><a href='javascript:void(0)' class='btn btn-primary btn-sm light'>$125,70</a></td>
											</tr>";
									
											$row	= mysqli_fetch_array($License_result);


									}
									
									?>	

										</tbody>
									</table>


                <!-- Row ends -->
            </div>
            <!-- container ends -->
        </div>
        <!--**********************************
                Content body end
            ***********************************-->


        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>© Designed &amp; Developed by <a href="https://7gate.kr/" target="_blank">podong28.com</a> 2019</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->
        
        
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="./js/custom.min.js"></script>
	<script src="./js/deznav-init.js"></script>
	
	<!-- Datatable -->
    <script src="./vendor/datatables/js/jquery.dataTables.min.js"></script>
	<script>
		(function($) {
			var table = $('#example2').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,         
				lengthChange:false 
				
			});
			var table = $('#example3').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,         
				lengthChange:false 
				
			});
			var table = $('#example4').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,         
				lengthChange:false 
				
			});
			var table = $('#example5').DataTable({
				searching: false,
				paging:true,
				select: false,
				//info: false,         
				lengthChange:false 
				
			});
			$('#example tbody').on('click', 'tr', function () {
				var data = table.row( this ).data();
				
			});
		})(jQuery);
	</script>
</body>
</html>